---
title: "Introduction to Tidyverse and Tidy Data"
author: "Bryan Blanc"
date: "Updated as of `r strftime(Sys.Date(),'%B %d, %Y')`"
output: html_document
---

[Back to overview](../index.html)

## Introduction

The [Tidyverse](https://www.tidyverse.org/) is a 'universe' of packages designed for data science with R. They are all built with an underlying design philosophy and grammar based on the [concept of 'tidy' data](https://vita.had.co.nz/papers/tidy-data.pdf). This session will discuss the tidy data concept and its main package implementations. For me, the tidy data concept influences not just the work I do in R but how I structure spreadsheets and datasets in general, and I have found it to generally result in cleaner data analyses.[Tidyverse packages](https://www.tidyverse.org/packages/) are among the most used R packages, and greatly improve upon implementations of basic operations in base R. 

__Acknowledgement:__ This module heavily draws upon Hadley Wickham's (the progenitor of the Tidyverse) book (available for free online), [R for Data Science](https://r4ds.had.co.nz/), including text, pictures, and code directly copied from that book and slightly modified to suit a shorter narrative. Printed copies are available generally wherever you get your books. It is recommended that you read this book for a deeper understanding of the topics contained hereien -- only basic concepts are able to be covered within the time available. 

## Tidyverse Packages

#ITALICS: Packages are sets of functions developed for a specific purpose that can be loaded into your library -- R is useful because of its packages. For more on packages, see [here](). 

As mentioned above, the Tidyverse consists of a collection of R packages -- several of the key packages are highlighted below. Some of these terms may be unfamiliar to you - we will discuss them in a moment. 

* [ggplot2](https://ggplot2.tidyverse.org), for data visualisation.
* [dplyr](https://dplyr.tidyverse.org), for data manipulation.
* [tidyr](https://tidyr.tidyverse.org), for data tidying.
* [readr](https://readr.tidyverse.org), for data import.
* [purrr](https://purrr.tidyverse.org), for functional programming.
* [tibble](https://tibble.tidyverse.org), for tibbles, a modern re-imagining of data frames.
* [stringr](https://github.com/tidyverse/stringr), for character strings.
* [forcats](https://github.com/hadley/forcats), for factors.

Conveniently, Hadley/RStudio created a [`tidyverse`](https://tidyverse.tidyverse.org/) package, which with a single installation command (`install.packages(tidyverse)`) will install the above packages, and with a single library command (`library(tidyverse)`) will load those packages into your environment. 

You also get a condensed summary of conflicts with other packages you have loaded:

```{r example, warning=FALSE}
library(tidyverse)
```

You can see conflicts created later with `tidyverse_conflicts()`:

```{r conflicts}
library(MASS)
tidyverse_conflicts()
```

As well as the core tidyverse, installing this package also installs a selection of other packages that you're likely to use frequently, but probably not in every analysis. This includes packages for:

*   Working with specific types of vectors:

    * [hms](https://github.com/rstats-db/hms), for times.
    * [lubridate](https://github.com/tidyverse/lubridate), for date/times.
    
*   Importing other types of data:

    * [feather](https://github.com/wesm/feather), for sharing with Python and other languages.
    * [haven](https://github.com/tidyverse/haven), for SPSS, SAS and Stata files.
    * [httr](https://github.com/r-lib/httr), for web apis.
    * [jsonlite](https://github.com/jeroen/jsonlite) for JSON.
    * [readxl](https://github.com/tidyverse/readxl), for `.xls` and `.xlsx` files.
    * [rvest](https://github.com/tidyverse/rvest), for web scraping.
    * [xml2](https://github.com/r-lib/xml2), for XML.

*   Modelling

    * [modelr](https://github.com/tidyverse/modelr), for modelling within a pipeline
    * [broom](https://github.com/tidymodels/broom), for turning models into 
      tidy data

And you can check that all tidyverse packages are up-to-date with `tidyverse_update()`:

```{r update, eval = FALSE}
tidyverse_update()
#> The following packages are out of date:
#>  * broom (0.4.0 -> 0.4.1)
#>  * DBI   (0.4.1 -> 0.5)
#>  * Rcpp  (0.12.6 -> 0.12.7)
#> Update now?
#> 
#> 1: Yes
#> 2: No
```

## The Key Parts of the Tidyverse Model of Data Science

Hadley proposes a model that nearly all data science projects adhere to, described by the below illustration. This module will give a high level overview of each of these concepts -- a deeper dive is needed, and it is again recommended to refer to [R for Data Science](https://r4ds.had.co.nz/). 

```{r echo = FALSE, out.width = "75%", fig.align='center'}
knitr::include_graphics("../graphics/diagrams/data-science.png")
```

### Tidy Data

You can represent the same underlying data in multiple ways. The example below shows the same data organised in four different ways. Each dataset shows the same values of four variables *country*, *year*, *population*, and *cases*, but each dataset organises the values in a different way.

```{r}
table1
table2
table3

# Spread across two tibbles
table4a  # cases
table4b  # population
```

These are all representations of the same underlying data, but they are not equally easy to use. One dataset, the tidy dataset, will be much easier to work with inside the tidyverse. 

There are three interrelated rules which make a dataset tidy:

1.  Each variable must have its own column.
1.  Each observation must have its own row.
1.  Each value must have its own cell.

The below illustration shows the rules visually: "Following three rules makes a dataset tidy: variables are in columns, observations are in rows, and values are in cells.

```{r tidy-structure, echo = FALSE, out.width = "100%"}
knitr::include_graphics("../graphics/images/tidy-1.png")
```

These three rules are interrelated because it's impossible to only satisfy two of the three. That interrelationship leads to an even simpler set of practical instructions:

1.  Put each dataset in a tibble.
1.  Put each variable in a column.

In this example, only `table1` is tidy. It's the only representation where each column is a variable.

Why ensure that your data is tidy? There are two main advantages:

1.  There's a general advantage to picking one consistent way of storing
    data. If you have a consistent data structure, it's easier to learn the
    tools that work with it because they have an underlying uniformity.
    
1.  There's a specific advantage to placing variables in columns because
    it allows R's vectorised nature to shine. Most 
    built-in R functions work with vectors of values. That makes transforming 
    tidy data feel particularly natural.

`dplyr`, `ggplot2`, and all the other packages in the tidyverse are designed to work with tidy data.
