<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>R Programming Basics - Session 2</title>

  <meta property="description" itemprop="description" content="A second session on the basics of R: functions, choice-based control flows, and iteration"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-02-17"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-02-17"/>
  <meta name="article:author" content="Bryan Blanc"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="R Programming Basics - Session 2"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="A second session on the basics of R: functions, choice-based control flows, and iteration"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="R Programming Basics - Session 2"/>
  <meta property="twitter:description" content="A second session on the basics of R: functions, choice-based control flows, and iteration"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories"]}},"value":[{"type":"character","attributes":{},"value":["R Programming Basics - Session 2"]},{"type":"character","attributes":{},"value":["A second session on the basics of R: functions, choice-based control flows, and iteration\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Bryan Blanc"]},{"type":"character","attributes":{},"value":["https://github.com/bpb824"]}]}]},{"type":"character","attributes":{},"value":["02-17-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["r-knowledge"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["images/base-r.png","r-programming-basics-session-2_files/anchor-4.2.2/anchor.min.js","r-programming-basics-session-2_files/bowser-1.9.3/bowser.min.js","r-programming-basics-session-2_files/distill-2.2.21/template.v2.js","r-programming-basics-session-2_files/header-attrs-2.6.1/header-attrs.js","r-programming-basics-session-2_files/jquery-1.11.3/jquery.min.js","r-programming-basics-session-2_files/popper-2.6.0/popper.min.js","r-programming-basics-session-2_files/tippy-6.2.7/tippy-bundle.umd.min.js","r-programming-basics-session-2_files/tippy-6.2.7/tippy-light-border.css","r-programming-basics-session-2_files/tippy-6.2.7/tippy.css","r-programming-basics-session-2_files/tippy-6.2.7/tippy.umd.min.js","r-programming-basics-session-2_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="r-programming-basics-session-2_files/header-attrs-2.6.1/header-attrs.js"></script>
  <script src="r-programming-basics-session-2_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="r-programming-basics-session-2_files/popper-2.6.0/popper.min.js"></script>
  <link href="r-programming-basics-session-2_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="r-programming-basics-session-2_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="r-programming-basics-session-2_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="r-programming-basics-session-2_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="r-programming-basics-session-2_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="r-programming-basics-session-2_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="r-programming-basics-session-2_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"R Programming Basics - Session 2","description":"A second session on the basics of R: functions, choice-based control flows, and iteration","authors":[{"author":"Bryan Blanc","authorURL":"https://github.com/bpb824","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-02-17T00:00:00.000-08:00","citationText":"Blanc, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>R Programming Basics - Session 2</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">r-knowledge</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>A second session on the basics of R: functions, choice-based control flows, and iteration</p></p>
</div>

<div class="d-byline">
  Bryan Blanc <a href="https://github.com/bpb824" class="uri">https://github.com/bpb824</a> 
  
<br/>02-17-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#todays-agenda">Today’s Agenda</a></li>
<li><a href="#functions">Functions</a>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#when-should-you-write-a-function">When should you write a function?</a></li>
<li><a href="#functions-are-for-humans-and-computers">Functions are for humans and computers</a></li>
<li><a href="#function-arguments">Function arguments</a>
<ul>
<li><a href="#choosing-names">Choosing names</a></li>
<li><a href="#checking-values">Checking values</a></li>
<li><a href="#dot-dot-dot">Dot-dot-dot (…)</a></li>
<li><a href="#lazy-evaluation">Lazy evaluation</a></li>
</ul></li>
<li><a href="#return-values">Return values</a>
<ul>
<li><a href="#explicit-return-statements">Explicit return statements</a></li>
<li><a href="#writing-pipeable-functions">Writing pipeable functions</a></li>
</ul></li>
<li><a href="#environment">Environment</a></li>
</ul></li>
<li><a href="#control-flows">Control Flows</a>
<ul>
<li><a href="#choices">Choices</a>
<ul>
<li><a href="#invalid-inputs">Invalid inputs</a></li>
<li><a href="#vectorised-if-ifelse">Vectorised if (<code>ifelse()</code>)</a></li>
<li><a href="#switch"><code>switch()</code> statement</a></li>
<li><a href="#vectorised-switch-case_when">Vectorised switch (<code>case_when()</code>)</a></li>
</ul></li>
<li><a href="#iteration">Iteration</a>
<ul>
<li><a href="#introduction-1">Introduction</a></li>
<li><a href="#for-loops">For loops</a></li>
<li><a href="#for-loop-variations">For loop variations</a></li>
<li><a href="#functional-iteration">Functional Iteration</a></li>
</ul></li>
</ul></li>
<li><a href="#reference-materials">Reference Materials</a>
<ul>
<li><a href="#cheat-sheets">Cheat Sheets</a></li>
<li><a href="#further-reading">Further Reading</a></li>
<li><a href="#related-datacamp-courses">Related DataCamp Courses</a></li>
</ul></li>
</ul>
</nav>
</div>
<p><em>This content was presented to Nelson\Nygaard Staff at a Lunch and Learn webinar on Wednesday, February 17th, 2021, and is <a href="https://web.microsoftstream.com/video/98f36726-76c1-4143-994f-6ecc55eace0b">available as a recording here</a> and embedded below.</em></p>
<p align="center">
<iframe width="640" height="360" src="https://web.microsoftstream.com/video/98f36726-76c1-4143-994f-6ecc55eace0b?autoplay=false&amp;showinfo=true" allowfullscreen style="border:none;">
</iframe>
</p>
<h1 id="todays-agenda">Today’s Agenda</h1>
<ul>
<li><a href="#functions">Functions (30 min)</a></li>
<li><a href="#choices">Choice-based control flows (15 min)</a></li>
<li><a href="#iteration">Simple iteration (15 min)</a></li>
</ul>
<p><strong>Acknowledgement:</strong> This module heavily draws upon Hadley Wickham’s (the progenitor of the Tidyverse) book (available for free online), <a href="https://r4ds.had.co.nz/">R for Data Science</a>, including text, pictures, and code directly copied from that book and slightly modified to suit a shorter narrative. Printed copies are available generally wherever you get your books. It is recommended that you read this book for a deeper understanding of the topics contained hereien – only basic concepts are able to be covered within the time available.</p>
<h1 id="functions">Functions</h1>
<h2 id="introduction">Introduction</h2>
<p>One of the best ways to improve your reach as a data scientist is to write functions. Functions allow you to automate common tasks in a more powerful and general way than copy-and-pasting. Writing a function has three big advantages over using copy-and-paste:</p>
<ol type="1">
<li><p>You can give a function an evocative name that makes your code easier to understand.</p></li>
<li><p>As requirements change, you only need to update code in one place, instead of many.</p></li>
<li><p>You eliminate the chance of making incidental mistakes when you copy and paste (i.e. updating a variable name in one place, but not in another).</p></li>
</ol>
<p>Writing good functions is a lifetime journey. Even after using R for many years, I still learn new techniques and better ways of approaching old problems. The goal of this section is not to teach you every esoteric detail of functions but to get you started with some pragmatic advice that you can apply immediately.</p>
<p>As well as practical advice for writing functions, this section also gives you some suggestions for how to style your code. Good code style is like correct punctuation. Youcanmanagewithoutit, but it sure makes things easier to read! As with styles of punctuation, there are many possible variations. Here we present the style we use in our code, but the most important thing is to be consistent.</p>
<h2 id="when-should-you-write-a-function">When should you write a function?</h2>
<p>You should consider writing a function whenever you’ve copied and pasted a block of code more than twice (i.e., you now have three copies of the same code). For example, take a look at this code. What does it do?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  a <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  b <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  c <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  d <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>df</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> 
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> 
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>c</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> 
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> 
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>You might be able to puzzle out that this rescales each column to have a range from 0 to 1. But did you spot the mistake? I made an error when copying-and-pasting the code for <code>df$b</code>: I forgot to change an <code>a</code> to a <code>b</code>. Extracting repeated code out into a function is a good idea because it prevents you from making this type of mistake.</p>
<p>To write a function you need to first analyze the code. How many inputs does it have?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span>
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>This code only has one input: <code>df$a</code>. (If you’re surprised that <code>TRUE</code> is not an input, you can explore why in the exercise below.) To make the inputs more clear, it’s a good idea to rewrite the code using temporary variables with general names. Here this code only requires a single numeric vector, so I’ll call it <code>x</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>df</span><span class='op'>$</span><span class='va'>a</span>
<span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 0.0000000 0.3212149 0.6461677 0.3807324 0.5022921 0.5610323
 [7] 0.6931002 0.6544424 1.0000000 0.1536904</code></pre>
</div>
<p>There is some duplication in this code. We’re computing the range of the data three times, so it makes sense to do it in one step:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rng</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>rng</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 0.0000000 0.3212149 0.6461677 0.3807324 0.5022921 0.5610323
 [7] 0.6931002 0.6544424 1.0000000 0.1536904</code></pre>
</div>
<p>Pulling out intermediate calculations into named variables is a good practice because it makes it more clear what the code is doing. Now that I’ve simplified the code, and checked that it still works, I can turn it into a function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rescale01</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>rng</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>rng</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>rescale01</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.0 0.5 1.0</code></pre>
</div>
<p>There are three key steps to creating a new function:</p>
<ol type="1">
<li><p>You need to pick a <strong>name</strong> for the function. Here I’ve used <code>rescale01</code> because this function rescales a vector to lie between 0 and 1.</p></li>
<li><p>You list the inputs, or <strong>arguments</strong>, to the function inside <code>function</code>. Here we have just one argument. If we had more the call would look like <code>function(x, y, z)</code>.</p></li>
<li><p>You place the code you have developed in <strong>body</strong> of the function, a <code>{</code> block that immediately follows <code>function(...)</code>.</p></li>
</ol>
<p>Note the overall process: I only made the function after I’d figured out how to make it work with a simple input. It’s easier to start with working code and turn it into a function; it’s harder to create a function and then try to make it work.</p>
<p>At this point it’s a good idea to check your function with a few different inputs:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rescale01</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>10</span>, <span class='fl'>0</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.0 0.5 1.0</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rescale01</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='cn'>NA</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.00 0.25 0.50   NA 1.00</code></pre>
</div>
<p>As you write more and more functions you’ll eventually want to convert these informal, interactive tests into formal, automated tests. That process is called unit testing. Unfortunately, it’s beyond the scope of this module, but you can learn about it in <a href="http://r-pkgs.had.co.nz/tests.html" class="uri">http://r-pkgs.had.co.nz/tests.html</a>.</p>
<p>We can simplify the original example now that we have a function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>c</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Compared to the original, this code is easier to understand and we’ve eliminated one class of copy-and-paste errors. There is still quite a bit of duplication since we’re doing the same thing to multiple columns. We’ll learn how to eliminate that duplication in <a href="#iteration">iteration</a>, once you’ve learned more about R’s data structures in [vectors].</p>
<p>Another advantage of functions is that if our requirements change, we only need to make the change in one place. For example, we might discover that some of our variables include infinite values, and <code>rescale01()</code> fails:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='cn'>Inf</span><span class='op'>)</span>
<span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]   0   0   0   0   0   0   0   0   0   0 NaN</code></pre>
</div>
<p>Because we’ve extracted the code into a function, we only need to make the fix in one place:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rescale01</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>rng</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span>, finite <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>rng</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 0.0000000 0.1111111 0.2222222 0.3333333 0.4444444 0.5555556
 [7] 0.6666667 0.7777778 0.8888889 1.0000000       Inf</code></pre>
</div>
<h2 id="functions-are-for-humans-and-computers">Functions are for humans and computers</h2>
<p>It’s important to remember that functions are not just for the computer, but are also for humans. R doesn’t care what your function is called, or what comments it contains, but these are important for human readers. This section discusses some things that you should bear in mind when writing functions that humans can understand.</p>
<p>The name of a function is important. Ideally, the name of your function will be short, but clearly evoke what the function does. That’s hard! But it’s better to be clear than short, as RStudio’s auto-complete makes it easy to type long names.</p>
<p>Generally, function names should be verbs, and arguments should be nouns. There are some exceptions: nouns are OK if the function computes a very well known noun (i.e. <code>mean()</code> is better than <code>compute_mean()</code>), or accessing some property of an object (i.e. <code>coef()</code> is better than <code>get_coefficients()</code>). A good sign that a noun might be a better choice is if you’re using a very broad verb like “get”, “compute”, “calculate”, or “determine”. Use your best judgment and don’t be afraid to rename a function if you figure out a better name later.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Too short</span>
<span class='fu'>f</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Not a verb, or descriptive</span>
<span class='fu'>my_awesome_function</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Long, but clear</span>
<span class='fu'>impute_missing</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>collapse_years</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>If your function name is composed of multiple words, I recommend using “snake_case”, where each lowercase word is separated by an underscore. camelCase is a popular alternative. It doesn’t really matter which one you pick, the important thing is to be consistent: pick one or the other and stick with it. R itself is not very consistent, but there’s nothing you can do about that. Make sure you don’t fall into the same trap by making your code as consistent as possible.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Never do this!</span>
<span class='va'>col_mins</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span><span class='op'>}</span>
<span class='va'>rowMaxes</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span><span class='op'>}</span>
</code></pre>
</div>
</div>
<p>If you have a family of functions that do similar things, make sure they have consistent names and arguments. Use a common prefix to indicate that they are connected. That’s better than a common suffix because auto-complete allows you to type the prefix and see all the members of the family.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Good</span>
<span class='fu'>input_select</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>input_checkbox</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>input_text</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Not so good</span>
<span class='fu'>select_input</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>checkbox_input</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>text_input</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>A good example of this design is the stringr package: if you don’t remember exactly which function you need, you can type <code>str_</code> and jog your memory.</p>
<p>Where possible, avoid overriding existing functions and variables. It’s impossible to do in general because so many good names are already taken by other packages, but avoiding the most common names from base R will avoid confusion.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Don't do this!</span>
<span class='cn'>T</span> <span class='op'>&lt;-</span> <span class='cn'>FALSE</span>
<span class='va'>c</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='va'>mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Use comments, lines starting with <code>#</code>, to explain the “why” of your code. You generally should avoid comments that explain the “what” or the “how”. If you can’t understand what the code does from reading it, you should think about how to rewrite it to be more clear. Do you need to add some intermediate variables with useful names? Do you need to break out a subcomponent of a large function so you can name it? However, your code can never capture the reasoning behind your decisions: why did you choose this approach instead of an alternative? What else did you try that didn’t work? It’s a great idea to capture that sort of thinking in a comment.</p>
<p>Another important use of comments is to break up your file into easily readable chunks. Use long lines of <code>-</code> and <code>=</code> to make it easy to spot the breaks.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Load data --------------------------------------</span>

<span class='co'># Plot data --------------------------------------</span>
</code></pre>
</div>
</div>
<h2 id="function-arguments">Function arguments</h2>
<p>The arguments to a function typically fall into two broad sets: one set supplies the <strong>data</strong> to compute on, and the other supplies arguments that control the <strong>details</strong> of the computation. For example:</p>
<ul>
<li><p>In <code>log()</code>, the data is <code>x</code>, and the detail is the <code>base</code> of the logarithm.</p></li>
<li><p>In <code>mean()</code>, the data is <code>x</code>, and the details are how much data to trim from the ends (<code>trim</code>) and how to handle missing values (<code>na.rm</code>).</p></li>
<li><p>In <code>t.test()</code>, the data are <code>x</code> and <code>y</code>, and the details of the test are <code>alternative</code>, <code>mu</code>, <code>paired</code>, <code>var.equal</code>, and <code>conf.level</code>.</p></li>
<li><p>In <code>str_c()</code> you can supply any number of strings to <code>...</code>, and the details of the concatenation are controlled by <code>sep</code> and <code>collapse</code>.</p></li>
</ul>
<p>Generally, data arguments should come first. Detail arguments should go on the end, and usually should have default values. You specify a default value in the same way you call a function with a named argument:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Compute confidence interval around mean using normal approximation</span>
<span class='va'>mean_ci</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>conf</span> <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>se</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>alpha</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>-</span> <span class='va'>conf</span>
  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>se</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>alpha</span> <span class='op'>/</span> <span class='fl'>2</span>, <span class='fl'>1</span> <span class='op'>-</span> <span class='va'>alpha</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>100</span><span class='op'>)</span>
<span class='fu'>mean_ci</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.4387887 0.5546397</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>mean_ci</span><span class='op'>(</span><span class='va'>x</span>, conf <span class='op'>=</span> <span class='fl'>0.99</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.4205872 0.5728412</code></pre>
</div>
<p>The default value should almost always be the most common value. The few exceptions to this rule are to do with safety. For example, it makes sense for <code>na.rm</code> to default to <code>FALSE</code> because missing values are important. Even though <code>na.rm = TRUE</code> is what you usually put in your code, it’s a bad idea to silently ignore missing values by default.</p>
<p>When you call a function, you typically omit the names of the data arguments, because they are used so commonly. If you override the default value of a detail argument, you should use the full name:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Good</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Bad</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, , <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span>, <span class='cn'>TRUE</span>, x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='cn'>NA</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>You can refer to an argument by its unique prefix (e.g. <code>mean(x, n = TRUE)</code>), but this is generally best avoided given the possibilities for confusion.</p>
<p>Notice that when you call a function, you should place a space around <code>=</code> in function calls, and always put a space after a comma, not before (just like in regular English). Using whitespace makes it easier to skim the function for the important components.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Good</span>
<span class='va'>average</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>feet</span> <span class='op'>/</span> <span class='fl'>12</span> <span class='op'>+</span> <span class='va'>inches</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Bad</span>
<span class='va'>average</span><span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>feet</span><span class='op'>/</span><span class='fl'>12</span><span class='op'>+</span><span class='va'>inches</span>,na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="choosing-names">Choosing names</h3>
<p>The names of the arguments are also important. R doesn’t care, but the readers of your code (including future-you!) will. Generally you should prefer longer, more descriptive names, but there are a handful of very common, very short names. It’s worth memorising these:</p>
<ul>
<li><code>x</code>, <code>y</code>, <code>z</code>: vectors.</li>
<li><code>w</code>: a vector of weights.</li>
<li><code>df</code>: a data frame.</li>
<li><code>i</code>, <code>j</code>: numeric indices (typically rows and columns).</li>
<li><code>n</code>: length, or number of rows.</li>
<li><code>p</code>: number of columns.</li>
</ul>
<p>Otherwise, consider matching names of arguments in existing R functions. For example, use <code>na.rm</code> to determine if missing values should be removed.</p>
<h3 id="checking-values">Checking values</h3>
<p>As you start to write more functions, you’ll eventually get to the point where you don’t remember exactly how your function works. At this point it’s easy to call your function with invalid inputs. To avoid this problem, it’s often useful to make constraints explicit. For example, imagine you’ve written some functions for computing weighted summary statistics:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wt_mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>*</span> <span class='va'>w</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>wt_var</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='fu'>wt_mean</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>mu</span><span class='op'>)</span> <span class='op'>^</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>wt_sd</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'>wt_var</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>What happens if <code>x</code> and <code>w</code> are not the same length?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>wt_mean</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 7.666667</code></pre>
</div>
<p>In this case, because of R’s vector recycling rules, we don’t get an error.</p>
<p>It’s good practice to check important preconditions, and throw an error (with <code>stop()</code>), if they are not true:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wt_mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>!=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"`x` and `w` must be the same length"</span>, call. <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Be careful not to take this too far. There’s a tradeoff between how much time you spend making your function robust, versus how long you spend writing it. For example, if you also added a <code>na.rm</code> argument, I probably wouldn’t check it carefully:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wt_mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span>, <span class='va'>na.rm</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/logical.html'>is.logical</a></span><span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"`na.rm` must be logical"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span> <span class='op'>!=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"`na.rm` must be length 1"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>!=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"`x` and `w` must be the same length"</span>, call. <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>miss</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>|</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
    <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span><span class='op'>!</span><span class='va'>miss</span><span class='op'>]</span>
    <span class='va'>w</span> <span class='op'>&lt;-</span> <span class='va'>w</span><span class='op'>[</span><span class='op'>!</span><span class='va'>miss</span><span class='op'>]</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>This is a lot of extra work for little additional gain. A useful compromise is the built-in <code>stopifnot()</code>: it checks that each argument is <code>TRUE</code>, and produces a generic error message if not.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wt_mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>w</span>, <span class='va'>na.rm</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/logical.html'>is.logical</a></span><span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>na.rm</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>miss</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>|</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
    <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span><span class='op'>!</span><span class='va'>miss</span><span class='op'>]</span>
    <span class='va'>w</span> <span class='op'>&lt;-</span> <span class='va'>w</span><span class='op'>[</span><span class='op'>!</span><span class='va'>miss</span><span class='op'>]</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>wt_mean</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='fl'>6</span><span class='op'>:</span><span class='fl'>1</span>, na.rm <span class='op'>=</span> <span class='st'>"foo"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Error in wt_mean(1:6, 6:1, na.rm = &quot;foo&quot;): is.logical(na.rm) is not TRUE</code></pre>
</div>
<p>Note that when using <code>stopifnot()</code> you assert what should be true rather than checking for what might be wrong.</p>
<h3 id="dot-dot-dot">Dot-dot-dot (…)</h3>
<p>Many functions in R take an arbitrary number of inputs:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>, <span class='fl'>9</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 55</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span>, <span class='st'>"d"</span>, <span class='st'>"e"</span>, <span class='st'>"f"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;abcdef&quot;</code></pre>
</div>
<p>How do these functions work? They rely on a special argument: <code>...</code> (pronounced dot-dot-dot). This special argument captures any number of arguments that aren’t otherwise matched.</p>
<p>It’s useful because you can then send those <code>...</code> on to another function. This is a useful catch-all if your function primarily wraps another function. For example, I commonly create these helper functions that wrap around <code>str_c()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>commas</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='va'>...</span>, collapse <span class='op'>=</span> <span class='st'>", "</span><span class='op'>)</span>
<span class='fu'>commas</span><span class='op'>(</span><span class='va'>letters</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;a, b, c, d, e, f, g, h, i, j&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rule</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>pad</span> <span class='op'>=</span> <span class='st'>"-"</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>title</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
  <span class='va'>width</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"width"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/nchar.html'>nchar</a></span><span class='op'>(</span><span class='va'>title</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>5</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='va'>title</span>, <span class='st'>" "</span>, <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_dup.html'>str_dup</a></span><span class='op'>(</span><span class='va'>pad</span>, <span class='va'>width</span><span class='op'>)</span>, <span class='st'>"\n"</span>, sep <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>rule</span><span class='op'>(</span><span class='st'>"Important output"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Important output -------------------------------------------------</code></pre>
</div>
<p>Here <code>...</code> lets me forward on any arguments that I don’t want to deal with to <code>str_c()</code>. It’s a very convenient technique. But it does come at a price: any misspelled arguments will not raise an error. This makes it easy for typos to go unnoticed:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span>, na.mr <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4</code></pre>
</div>
<p>If you just want to capture the values of the <code>...</code>, use <code>list(...)</code>.</p>
<h3 id="lazy-evaluation">Lazy evaluation</h3>
<p>Arguments in R are lazily evaluated: they’re not computed until they’re needed. That means if they’re never used, they’re never called. This is an important property of R as a programming language, but is generally not important when you’re writing your own functions for data analysis. You can read more about lazy evaluation at <a href="http://adv-r.had.co.nz/Functions.html#lazy-evaluation" class="uri">http://adv-r.had.co.nz/Functions.html#lazy-evaluation</a>.</p>
<h2 id="return-values">Return values</h2>
<p>Figuring out what your function should return is usually straightforward: it’s why you created the function in the first place! There are two things you should consider when returning a value:</p>
<ol type="1">
<li><p>Does returning early make your function easier to read?</p></li>
<li><p>Can you make your function pipeable?</p></li>
</ol>
<h3 id="explicit-return-statements">Explicit return statements</h3>
<p>The value returned by the function is usually the last statement it evaluates, but you can choose to return early by using <code>return()</code>. I think it’s best to save the use of <code>return()</code> to signal that you can return early with a simpler solution. A common reason to do this is because the inputs are empty:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>complicated_function</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>z</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>||</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span>
  <span class='op'>}</span>
    
  <span class='co'># Complicated code here</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Another reason is because you have a <code>if</code> statement with one complex block and one simple block. For example, you might write an if statement like this:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># Do </span>
    <span class='co'># something</span>
    <span class='co'># that</span>
    <span class='co'># takes</span>
    <span class='co'># many</span>
    <span class='co'># lines</span>
    <span class='co'># to</span>
    <span class='co'># express</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='co'># return something short</span>
  <span class='op'>}</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>But if the first block is very long, by the time you get to the <code>else</code>, you’ve forgotten the <code>condition</code>. One way to rewrite it is to use an early return for the simple case:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>something_short</span><span class='op'>)</span>
  <span class='op'>}</span>

  <span class='co'># Do </span>
  <span class='co'># something</span>
  <span class='co'># that</span>
  <span class='co'># takes</span>
  <span class='co'># many</span>
  <span class='co'># lines</span>
  <span class='co'># to</span>
  <span class='co'># express</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>This tends to make the code easier to understand, because you don’t need quite so much context to understand it.</p>
<h3 id="writing-pipeable-functions">Writing pipeable functions</h3>
<p>If you want to write your own pipeable functions, it’s important to think about the return value. Knowing the return value’s object type will mean that your pipeline will “just work”. For example, with dplyr and tidyr the object type is the data frame.</p>
<p>There are two basic types of pipeable functions: transformations and side-effects. With <strong>transformations</strong>, an object is passed to the function’s first argument and a modified object is returned. With <strong>side-effects</strong>, the passed object is not transformed. Instead, the function performs an action on the object, like drawing a plot or saving a file. Side-effects functions should “invisibly” return the first argument, so that while they’re not printed they can still be used in a pipeline. For example, this simple function prints the number of missing values in a data frame:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>show_missings</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Missing values: "</span>, <span class='va'>n</span>, <span class='st'>"\n"</span>, sep <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
  
  <span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>If we call it interactively, the <code>invisible()</code> means that the input <code>df</code> doesn’t get printed out:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>show_missings</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Missing values: 0</code></pre>
</div>
<p>But it’s still there, it’s just not printed by default:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>show_missings</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>Missing values: 0</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 32 11</code></pre>
</div>
<p>And we can still use it in a pipe:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mtcars</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>show_missings</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>mpg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>&lt;</span> <span class='fl'>20</span>, <span class='cn'>NA</span>, <span class='va'>mpg</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>show_missings</span><span class='op'>(</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>Missing values: 0
Missing values: 18</code></pre>
</div>
<h2 id="environment">Environment</h2>
<p>The last component of a function is its environment. This is not something you need to understand deeply when you first start writing functions. However, it’s important to know a little bit about environments because they are crucial to how functions work. The environment of a function controls how R finds the value associated with a name. For example, take this function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>+</span> <span class='va'>y</span>
<span class='op'>}</span> 
</code></pre>
</div>
</div>
<p>In many programming languages, this would be an error, because <code>y</code> is not defined inside the function. In R, this is valid code because R uses rules called <strong>lexical scoping</strong> to find the value associated with a name. Since <code>y</code> is not defined inside the function, R will look in the <strong>environment</strong> where the function was defined:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='fu'>f</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 110</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='fu'>f</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1010</code></pre>
</div>
<p>This behaviour seems like a recipe for bugs, and indeed you should avoid creating functions like this deliberately, but by and large it doesn’t cause too many problems (especially if you regularly restart R to get to a clean slate).</p>
<p>The advantage of this behaviour is that from a language standpoint it allows R to be very consistent. Every name is looked up using the same set of rules. For <code>f()</code> that includes the behaviour of two things that you might not expect: <code>{</code> and <code>+</code>. This allows you to do devious things like:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>`+`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>1.1</span>
  <span class='op'>}</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
  3 3.3 
110 890 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span><span class='va'>`+`</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>This is a common phenomenon in R. R places few limits on your power. You can do many things that you can’t do in other programming languages. You can do many things that 99% of the time are extremely ill-advised (like overriding how addition works!). But this power and flexibility is what makes tools like ggplot2 and dplyr possible. Learning how to make best use of this flexibility is beyond the scope of this book, but you can read about in <a href="http://adv-r.had.co.nz"><em>Advanced R</em></a>.</p>
<h1 id="control-flows">Control Flows</h1>
<p>There are two primary tools of control flow: choices and loops. Choices, like <code>if</code> statements and <code>switch()</code> calls, allow you to run different code depending on the input. Loops, like <code>for</code> and <code>while</code>, allow you to repeatedly run code, typically with changing options. We’ll discuss loops in the <a href="#iteration">iteration section</a>, following the below discussion about choices.</p>
<h2 id="choices">Choices</h2>
<p>The basic form of an if statement in R is as follows:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='va'>condition</span><span class='op'>)</span> <span class='va'>true_action</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='va'>condition</span><span class='op'>)</span> <span class='va'>true_action</span> <span class='kw'>else</span> <span class='va'>false_action</span>
</code></pre>
</div>
</div>
<p>If <code>condition</code> is <code>TRUE</code>, <code>true_action</code> is evaluated; if <code>condition</code> is <code>FALSE</code>, the optional <code>false_action</code> is evaluated.</p>
<p>Typically the actions are compound statements contained within <code>{</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grade</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>&gt;</span> <span class='fl'>90</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"A"</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>&gt;</span> <span class='fl'>80</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"B"</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>&gt;</span> <span class='fl'>50</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"C"</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='st'>"F"</span>
  <span class='op'>}</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p><code>if</code> returns a value so that you can assign the results:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x1</span> <span class='op'>&lt;-</span> <span class='kw'>if</span> <span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='fl'>1</span> <span class='kw'>else</span> <span class='fl'>2</span>
<span class='va'>x2</span> <span class='op'>&lt;-</span> <span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fl'>1</span> <span class='kw'>else</span> <span class='fl'>2</span>

<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='va'>x2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1 2</code></pre>
</div>
<p>(I recommend assigning the results of an <code>if</code> statement only when the entire expression fits on one line; otherwise it tends to be hard to read.)</p>
<p>When you use the single argument form without an else statement, <code>if</code> invisibly (Section <a href="#invisible"><strong>??</strong></a>) returns <code>NULL</code> if the condition is <code>FALSE</code>. Since functions like <code>c()</code> and <code>paste()</code> drop <code>NULL</code> inputs, this allows for a compact expression of certain idioms:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>greet</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>name</span>, <span class='va'>birthday</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='st'>"Hi "</span>, <span class='va'>name</span>,
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>birthday</span><span class='op'>)</span> <span class='st'>" and HAPPY BIRTHDAY"</span>
  <span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>greet</span><span class='op'>(</span><span class='st'>"Maria"</span>, <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Hi Maria&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>greet</span><span class='op'>(</span><span class='st'>"Jaime"</span>, <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Hi Jaime and HAPPY BIRTHDAY&quot;</code></pre>
</div>
<h3 id="invalid-inputs">Invalid inputs</h3>
<p>The <code>condition</code> should evaluate to a single <code>TRUE</code> or <code>FALSE</code>. Most other inputs will generate an error:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='st'>"x"</span><span class='op'>)</span> <span class='fl'>1</span>
</code></pre>
</div>
<pre><code>Error in if (&quot;x&quot;) 1: argument is not interpretable as logical</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/logical.html'>logical</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='fl'>1</span>
</code></pre>
</div>
<pre><code>Error in if (logical()) 1: argument is of length zero</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>NA</span><span class='op'>)</span> <span class='fl'>1</span>
</code></pre>
</div>
<pre><code>Error in if (NA) 1: missing value where TRUE/FALSE needed</code></pre>
</div>
<p>The exception is a logical vector of length greater than 1, which generates a warning:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span> <span class='fl'>1</span>
</code></pre>
</div>
<pre><code>[1] 1</code></pre>
</div>
<p>In R 3.5.0 and greater, thanks to <a href="https://github.com/HenrikBengtsson/Wishlist-for-R/issues/38">Henrik Bengtsson</a>, you can turn this into an error by setting an environment variable:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Sys.setenv.html'>Sys.setenv</a></span><span class='op'>(</span><span class='st'>"_R_CHECK_LENGTH_1_CONDITION_"</span> <span class='op'>=</span> <span class='st'>"true"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span> <span class='fl'>1</span>
</code></pre>
</div>
<pre><code>Error in if (c(TRUE, FALSE)) 1: the condition has length &gt; 1</code></pre>
</div>
<p>I think this is good practice as it reveals a clear mistake that you might otherwise miss if it were only shown as a warning.</p>
<h3 id="vectorised-if-ifelse">Vectorised if (<code>ifelse()</code>)</h3>
<p>Given that <code>if</code> only works with a single <code>TRUE</code> or <code>FALSE</code>, you might wonder what to do if you have a vector of logical values. Handling vectors of values is the job of <code>ifelse()</code>: a vectorised function with <code>test</code>, <code>yes</code>, and <code>no</code> vectors (that will be recycled to the same length):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>%%</span> <span class='fl'>5</span> <span class='op'>==</span> <span class='fl'>0</span>, <span class='st'>"XXX"</span>, <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;1&quot;   &quot;2&quot;   &quot;3&quot;   &quot;4&quot;   &quot;XXX&quot; &quot;6&quot;   &quot;7&quot;   &quot;8&quot;   &quot;9&quot;   &quot;XXX&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>%%</span> <span class='fl'>2</span> <span class='op'>==</span> <span class='fl'>0</span>, <span class='st'>"even"</span>, <span class='st'>"odd"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;odd&quot;  &quot;even&quot; &quot;odd&quot;  &quot;even&quot; &quot;odd&quot;  &quot;even&quot; &quot;odd&quot;  &quot;even&quot; &quot;odd&quot; 
[10] &quot;even&quot;</code></pre>
</div>
<p>Note that missing values will be propagated into the output.</p>
<p>I recommend using <code>ifelse()</code> only when the <code>yes</code> and <code>no</code> vectors are the same type as it is otherwise hard to predict the output type. See <a href="https://vctrs.r-lib.org/articles/stability.html#ifelse" class="uri">https://vctrs.r-lib.org/articles/stability.html#ifelse</a> for additional discussion.</p>
<p>Another vectorised equivalent is the more general <code>dplyr::case_when()</code>. It uses a special syntax to allow any number of condition-vector pairs:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
  <span class='va'>x</span> <span class='op'>%%</span> <span class='fl'>35</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"fizz buzz"</span>,
  <span class='va'>x</span> <span class='op'>%%</span> <span class='fl'>5</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"fizz"</span>,
  <span class='va'>x</span> <span class='op'>%%</span> <span class='fl'>7</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"buzz"</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"???"</span>,
  <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;1&quot;    &quot;2&quot;    &quot;3&quot;    &quot;4&quot;    &quot;fizz&quot; &quot;6&quot;    &quot;buzz&quot; &quot;8&quot;    &quot;9&quot;   
[10] &quot;fizz&quot;</code></pre>
</div>
<h3 id="switch"><code>switch()</code> statement</h3>
<p>Closely related to <code>if</code> is the <code>switch()</code>-statement. It’s a compact, special purpose equivalent that lets you replace code like:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x_option</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>==</span> <span class='st'>"a"</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"option 1"</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>==</span> <span class='st'>"b"</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"option 2"</span> 
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'>==</span> <span class='st'>"c"</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='st'>"option 3"</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Invalid `x` value"</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>with the more succinct:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x_option</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/switch.html'>switch</a></span><span class='op'>(</span><span class='va'>x</span>,
    a <span class='op'>=</span> <span class='st'>"option 1"</span>,
    b <span class='op'>=</span> <span class='st'>"option 2"</span>,
    c <span class='op'>=</span> <span class='st'>"option 3"</span>,
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Invalid `x` value"</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>The last component of a <code>switch()</code> should always throw an error, otherwise unmatched inputs will invisibly return <code>NULL</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/switch.html'>switch</a></span><span class='op'>(</span><span class='st'>"c"</span>, a <span class='op'>=</span> <span class='fl'>1</span>, b <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>NULL</code></pre>
</div>
<p>If multiple inputs have the same output, you can leave the right hand side of <code>=</code> empty and the input will “fall through” to the next value. This mimics the behaviour of C’s <code>switch</code> statement:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>legs</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/switch.html'>switch</a></span><span class='op'>(</span><span class='va'>x</span>,
    cow <span class='op'>=</span> ,
    horse <span class='op'>=</span> ,
    dog <span class='op'>=</span> <span class='fl'>4</span>,
    human <span class='op'>=</span> ,
    chicken <span class='op'>=</span> <span class='fl'>2</span>,
    plant <span class='op'>=</span> <span class='fl'>0</span>,
    <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Unknown input"</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>legs</span><span class='op'>(</span><span class='st'>"cow"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>legs</span><span class='op'>(</span><span class='st'>"dog"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4</code></pre>
</div>
<p>It is also possible to use <code>switch()</code> with a numeric <code>x</code>, but is harder to read, and has undesirable failure modes if <code>x</code> is a not a whole number. I recommend using <code>switch()</code> only with character inputs.</p>
<h3 id="vectorised-switch-case_when">Vectorised switch (<code>case_when()</code>)</h3>
<p>I rarely use the switch statement, because of its nearly identical nature to using a series of <code>else if()</code> statements, but I do use switch’s vectorized analogue, <code>case_when()</code>, instead of having to write nested <code>ifelse()</code> function calls. It is very useful when dividing data into more than two categories, which is how I use it most often. An example of dividing hours of the day into time categories (a typical process I use it for) is provided below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>hour_frame</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  hour <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>23</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>time_cat <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
    <span class='va'>hour</span> <span class='op'>&gt;=</span><span class='fl'>5</span> <span class='op'>&amp;</span> <span class='va'>hour</span> <span class='op'>&lt;=</span> <span class='fl'>6</span> <span class='op'>~</span> <span class='st'>'Early AM'</span>,
    <span class='va'>hour</span> <span class='op'>&gt;=</span><span class='fl'>7</span> <span class='op'>&amp;</span> <span class='va'>hour</span> <span class='op'>&lt;=</span><span class='fl'>9</span><span class='op'>~</span> <span class='st'>'AM Peak'</span>,
    <span class='va'>hour</span> <span class='op'>&gt;=</span><span class='fl'>10</span> <span class='op'>&amp;</span> <span class='va'>hour</span> <span class='op'>&lt;=</span><span class='fl'>15</span> <span class='op'>~</span> <span class='st'>'Mid-day'</span>,
    <span class='va'>hour</span> <span class='op'>&gt;=</span><span class='fl'>16</span> <span class='op'>&amp;</span> <span class='va'>hour</span> <span class='op'>&lt;=</span><span class='fl'>18</span> <span class='op'>~</span> <span class='st'>'PM Peak'</span>,
    <span class='va'>hour</span> <span class='op'>&gt;=</span><span class='fl'>19</span>  <span class='op'>&amp;</span> <span class='va'>hour</span> <span class='op'>&lt;=</span><span class='fl'>23</span> <span class='op'>~</span> <span class='st'>'Evening'</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>'Overnight'</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>hour_frame</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 24 x 2
    hour time_cat 
   &lt;int&gt; &lt;chr&gt;    
 1     0 Overnight
 2     1 Overnight
 3     2 Overnight
 4     3 Overnight
 5     4 Overnight
 6     5 Early AM 
 7     6 Early AM 
 8     7 AM Peak  
 9     8 AM Peak  
10     9 AM Peak  
# ... with 14 more rows</code></pre>
</div>
<h2 id="iteration">Iteration</h2>
<h3 id="introduction-1">Introduction</h3>
<p>In <a href="#functions">functions</a>, we talked about how important it is to reduce duplication in your code by creating functions instead of copying-and-pasting. Reducing code duplication has three main benefits:</p>
<ol type="1">
<li><p>It’s easier to see the intent of your code, because your eyes are drawn to what’s different, not what stays the same.</p></li>
<li><p>It’s easier to respond to changes in requirements. As your needs change, you only need to make changes in one place, rather than remembering to change every place that you copied-and-pasted the code.</p></li>
<li><p>You’re likely to have fewer bugs because each line of code is used in more places.</p></li>
</ol>
<p>One tool for reducing duplication is functions, which reduce duplication by identifying repeated patterns of code and extract them out into independent pieces that can be easily reused and updated. Another tool for reducing duplication is <strong>iteration</strong>, which helps you when you need to do the same thing to multiple inputs: repeating the same operation on different columns, or on different datasets. In this chapter you’ll learn about two important iteration paradigms: imperative programming and functional programming. On the imperative side you have tools like for loops and while loops, which are a great place to start because they make iteration very explicit, so it’s obvious what’s happening. However, for loops are quite verbose, and require quite a bit of bookkeeping code that is duplicated for every for loop. Functional programming (FP) offers tools to extract out this duplicated code, so each common for loop pattern gets its own function. Once you master the vocabulary of FP, you can solve many common iteration problems with less code, more ease, and fewer errors.</p>
<h3 id="for-loops">For loops</h3>
<p>Imagine we have this simple tibble:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  a <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  b <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  c <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  d <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We want to compute the median of each column. You <em>could</em> do with copy-and-paste:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.299398</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -0.5005192</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -0.144395</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -0.2095482</code></pre>
</div>
<p>But that breaks our rule of thumb: never copy and paste more than twice. Instead, we could use a for loop:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>output</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>"double"</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># 1. output</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>            <span class='co'># 2. sequence</span>
  <span class='va'>output</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>      <span class='co'># 3. body</span>
<span class='op'>}</span>
<span class='va'>output</span>
</code></pre>
</div>
<pre><code>[1]  0.2993980 -0.5005192 -0.1443950 -0.2095482</code></pre>
</div>
<p>Every for loop has three components:</p>
<ol type="1">
<li><p>The <strong>output</strong>: <code>output &lt;- vector("double", length(x))</code>. Before you start the loop, you must always allocate sufficient space for the output. This is very important for efficiency: if you grow the for loop at each iteration using <code>c()</code> (for example), your for loop will be very slow.</p>
<p>A general way of creating an empty vector of given length is the <code>vector()</code> function. It has two arguments: the type of the vector (“logical”, “integer”, “double”, “character”, etc) and the length of the vector.</p></li>
<li><p>The <strong>sequence</strong>: <code>i in seq_along(df)</code>. This determines what to loop over: each run of the for loop will assign <code>i</code> to a different value from <code>seq_along(df)</code>. It’s useful to think of <code>i</code> as a pronoun, like “it”.</p>
<p>You might not have seen <code>seq_along()</code> before. It’s a safe version of the familiar <code>1:length(l)</code>, with an important difference: if you have a zero-length vector, <code>seq_along()</code> does the right thing:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>"double"</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>integer(0)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1 0</code></pre>
</div>
<p>You probably won’t create a zero-length vector deliberately, but it’s easy to create them accidentally. If you use <code>1:length(x)</code> instead of <code>seq_along(x)</code>, you’re likely to get a confusing error message.</p></li>
<li><p>The <strong>body</strong>: <code>output[[i]] &lt;- median(df[[i]])</code>. This is the code that does the work. It’s run repeatedly, each time with a different value for <code>i</code>. The first iteration will run <code>output[[1]] &lt;- median(df[[1]])</code>, the second will run <code>output[[2]] &lt;- median(df[[2]])</code>, and so on.</p></li>
</ol>
<h3 id="for-loop-variations">For loop variations</h3>
<p>Once you have the basic for loop under your belt, there are some variations that you should be aware of. These variations are important regardless of how you do iteration, so don’t forget about them once you’ve mastered the FP techniques you’ll learn about in the next section.</p>
<p>There are four variations on the basic theme of the for loop:</p>
<ol type="1">
<li>Modifying an existing object, instead of creating a new object.</li>
<li>Looping over names or values, instead of indices.</li>
<li>Handling outputs of unknown length.</li>
<li>Handling sequences of unknown length.</li>
</ol>
<h4 id="modifying-an-existing-object">Modifying an existing object</h4>
<p>Sometimes you want to use a for loop to modify an existing object. For example, remember our challenge from <a href="#functions">functions</a>. We wanted to rescale every column in a data frame:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  a <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  b <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  c <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>,
  d <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>rescale01</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>rng</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>rng</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>rng</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>df</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>a</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>b</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>c</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>c</span><span class='op'>)</span>
<span class='va'>df</span><span class='op'>$</span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>$</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>To solve this with a for loop we again think about the three components:</p>
<ol type="1">
<li><p><strong>Output</strong>: we already have the output — it’s the same as the input!</p></li>
<li><p><strong>Sequence</strong>: we can think about a data frame as a list of columns, so we can iterate over each column with <code>seq_along(df)</code>.</p></li>
<li><p><strong>Body</strong>: apply <code>rescale01()</code>.</p></li>
</ol>
<p>This gives us:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>df</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale01</span><span class='op'>(</span><span class='va'>df</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Typically you’ll be modifying a list or data frame with this sort of loop, so remember to use <code>[[</code>, not <code>[</code>. You might have spotted that I used <code>[[</code> in all my for loops: I think it’s better to use <code>[[</code> even for atomic vectors because it makes it clear that I want to work with a single element.</p>
<h4 id="looping-patterns">Looping patterns</h4>
<p>There are three basic ways to loop over a vector. So far I’ve shown you the most general: looping over the numeric indices with <code>for (i in seq_along(xs))</code>, and extracting the value with <code>x[[i]]</code>. There are two other forms:</p>
<ol type="1">
<li><p>Loop over the elements: <code>for (x in xs)</code>. This is most useful if you only care about side-effects, like plotting or saving a file, because it’s difficult to save the output efficiently.</p></li>
<li><p>Loop over the names: <code>for (nm in names(xs))</code>. This gives you name, which you can use to access the value with <code>x[[nm]]</code>. This is useful if you want to use the name in a plot title or a file name. If you’re creating named output, make sure to name the results vector like so:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>results</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>"list"</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>results</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
</div></li>
</ol>
<p>Iteration over the numeric indices is the most general form, because given the position you can extract both the name and the value:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>name</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>
  <span class='va'>value</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h4 id="unknown-output-length">Unknown output length</h4>
<p>Sometimes you might not know how long the output will be. For example, imagine you want to simulate some random vectors of random lengths. You might be tempted to solve this problem by progressively growing the vector:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>means</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>

<span class='va'>output</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>double</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>means</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>1</span><span class='op'>)</span>
  <span class='va'>output</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>output</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>means</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>output</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> num [1:125] -0.414 1.401 0.706 -0.101 -1.706 ...</code></pre>
</div>
<p>But this is not very efficient because in each iteration, R has to copy all the data from the previous iterations. In technical terms you get “quadratic” (<span class="math inline">\(O(n^2)\)</span>) behaviour which means that a loop with three times as many elements would take nine (<span class="math inline">\(3^2\)</span>) times as long to run.</p>
<p>A better solution to save the results in a list, and then combine into a single vector after the loop is done:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>"list"</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>means</span><span class='op'>)</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>means</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>1</span><span class='op'>)</span>
  <span class='va'>out</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>means</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>List of 3
 $ : num [1:42] 0.567 -1.2545 -0.8033 -2.2664 0.0231 ...
 $ : num [1:35] 2.877 0.117 2.138 1.561 1.62 ...
 $ : num [1:32] 3.077 2.658 -0.308 1.395 2.188 ...</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> num [1:109] 0.567 -1.2545 -0.8033 -2.2664 0.0231 ...</code></pre>
</div>
<p>Here I’ve used <code>unlist()</code> to flatten a list of vectors into a single vector. A stricter option is to use <code>purrr::flatten_dbl()</code> — it will throw an error if the input isn’t a list of doubles.</p>
<p>This pattern occurs in other places too:</p>
<ol type="1">
<li><p>You might be generating a long string. Instead of <code>paste()</code>ing together each iteration with the previous, save the output in a character vector and then combine that vector into a single string with <code>paste(output, collapse = "")</code>.</p></li>
<li><p>You might be generating a big data frame. Instead of sequentially <code>rbind()</code>ing in each iteration, save the output in a list, then use <code>dplyr::bind_rows(output)</code> to combine the output into a single data frame.</p></li>
</ol>
<p>Watch out for this pattern. Whenever you see it, switch to a more complex result object, and then combine in one step at the end.</p>
<h4 id="unknown-sequence-length">Unknown sequence length</h4>
<p>Sometimes you don’t even know how long the input sequence should run for. This is common when doing simulations. For example, you might want to loop until you get three heads in a row. You can’t do that sort of iteration with the for loop. Instead, you can use a while loop. A while loop is simpler than for loop because it only has two components, a condition and a body:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>while</span> <span class='op'>(</span><span class='va'>condition</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># body</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>A while loop is also more general than a for loop, because you can rewrite any for loop as a while loop, but you can’t rewrite every while loop as a for loop:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># body</span>
<span class='op'>}</span>

<span class='co'># Equivalent to</span>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='kw'>while</span> <span class='op'>(</span><span class='va'>i</span> <span class='op'>&lt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># body</span>
  <span class='va'>i</span> <span class='op'>&lt;-</span> <span class='va'>i</span> <span class='op'>+</span> <span class='fl'>1</span> 
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Here’s how we could use a while loop to find how many tries it takes to get three heads in a row:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>flip</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"T"</span>, <span class='st'>"H"</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>flips</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>nheads</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>

<span class='kw'>while</span> <span class='op'>(</span><span class='va'>nheads</span> <span class='op'>&lt;</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'>flip</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>==</span> <span class='st'>"H"</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>nheads</span> <span class='op'>&lt;-</span> <span class='va'>nheads</span> <span class='op'>+</span> <span class='fl'>1</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>nheads</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
  <span class='op'>}</span>
  <span class='va'>flips</span> <span class='op'>&lt;-</span> <span class='va'>flips</span> <span class='op'>+</span> <span class='fl'>1</span>
<span class='op'>}</span>
<span class='va'>flips</span>
</code></pre>
</div>
<pre><code>[1] 3</code></pre>
</div>
<p>I mention while loops only briefly, because I hardly ever use them. They’re most often used for simulation, which is outside the scope of this module. However, it is good to know they exist so that you’re prepared for problems where the number of iterations is not known in advance.</p>
<h3 id="functional-iteration">Functional Iteration</h3>
<p>We do not have time to cover functional iteration with <code>purrr</code> in this session – I would refer you prior sessions in which this was covered:</p>
<ul>
<li><a href="../tidyverse/">Introduction to the Tidyverse, presented on August 21, 2020</a></li>
<li><a href="../miscellaneous-questions/">Miscellaneous Question Session, presented on October 13, 2020</a></li>
</ul>
<p>It is also recommended to read the <a href="https://r4ds.had.co.nz/iteration.html">iteration chapter in R for Data Science</a>, where much of this content was drawn from.</p>
<h1 id="reference-materials">Reference Materials</h1>
<h2 id="cheat-sheets">Cheat Sheets</h2>
<ul>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/base-r.pdf"><img src="images/base-r.png" alt="Base R Cheatsheet" /></a></li>
</ul>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a>, by Garrett Grolemund and Hadley Wickham.</li>
<li><a href="https://adv-r.hadley.nz/index.html">Advanced R</a>, by Hadley Wickham.</li>
</ul>
<h2 id="related-datacamp-courses">Related DataCamp Courses</h2>
<ul>
<li><a href="https://learn.datacamp.com/courses/intermediate-r">Intermediate R</a> (4 hours)</li>
</ul>
<p><em>This content was presented to Nelson\Nygaard Staff at a Lunch and Learn webinar on Wednesday, February 17th, 2021, and is <a href="https://web.microsoftstream.com/video/98f36726-76c1-4143-994f-6ecc55eace0b">available as a recording here</a> and embedded at the top of the page.</em></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
