<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Nelson\Nygaard R Training Blog: Google Travel Time Querying</title>

<meta property="description" itemprop="description" content="Usage of the googleway package for travel time querying."/>

<link rel="canonical" href="https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-01-15"/>
<meta property="article:created" itemprop="dateCreated" content="2021-01-15"/>
<meta name="article:author" content="Bryan Blanc"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Nelson\Nygaard R Training Blog: Google Travel Time Querying"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Usage of the googleway package for travel time querying."/>
<meta property="og:url" content="https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/"/>
<meta property="og:image" content="https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/google-travel-time-querying_files/figure-html5/tti-fig-1-1.png"/>
<meta property="og:image:width" content="2304"/>
<meta property="og:image:height" content="1536"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Nelson\Nygaard R Training Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Nelson\Nygaard R Training Blog: Google Travel Time Querying"/>
<meta property="twitter:description" content="Usage of the googleway package for travel time querying."/>
<meta property="twitter:url" content="https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/"/>
<meta property="twitter:image" content="https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/google-travel-time-querying_files/figure-html5/tti-fig-1-1.png"/>
<meta property="twitter:image:width" content="2304"/>
<meta property="twitter:image:height" content="1536"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Google Travel Time Querying"]},{"type":"character","attributes":{},"value":["Usage of the googleway package for travel time querying."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Bryan Blanc"]},{"type":"character","attributes":{},"value":["https://github.com/bpb824"]}]}]},{"type":"character","attributes":{},"value":["01-15-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["geospatial","google-apis"]},{"type":"character","attributes":{},"value":["https://perkinsandwill.github.io/nn_r_training/posts/2021-01-15-google-travel-time-querying/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data/replica/Austin-Round-Rock--TX.csv","data/replica/Boston-Cambridge-Newton--MA-NH.csv","data/replica/Chicago-Naperville-Elgin--IL-IN-WI.csv","data/replica/New-York-Newark-Jersey-City--NY-NJ-PA.csv","data/replica/Portland-Vancouver-Hillsboro--OR-WA.csv","data/replica/San-Francisco-Oakland-Hayward--CA.csv","data/replica/Seattle-Tacoma-Bellevue--WA.csv","data/replica/Washington-Arlington-Alexandria--DC-VA-MD-WV.csv","data/table_01_70_112119.xlsx","data/table_01_71q113.xlsx","google-travel-time-querying_files/anchor-4.2.2/anchor.min.js","google-travel-time-querying_files/bowser-1.9.3/bowser.min.js","google-travel-time-querying_files/distill-2.2.21/template.v2.js","google-travel-time-querying_files/figure-html5/boston-ex-part-3-1.png","google-travel-time-querying_files/figure-html5/replica-fig-1-1.png","google-travel-time-querying_files/figure-html5/replica-fig-2-1.png","google-travel-time-querying_files/figure-html5/tt-index-adjust-1.png","google-travel-time-querying_files/figure-html5/tti-fig-1-1.png","google-travel-time-querying_files/google_map-binding-2.7.3/google_map.js","google-travel-time-querying_files/header-attrs-2.6.1/header-attrs.js","google-travel-time-querying_files/htmlwidgets-1.5.1/htmlwidgets.js","google-travel-time-querying_files/jquery-1.11.3/jquery.min.js","google-travel-time-querying_files/map-1.0.0/charts.js","google-travel-time-querying_files/map-1.0.0/geolocation.js","google-travel-time-querying_files/map-1.0.0/legend.js","google-travel-time-querying_files/map-1.0.0/map_events.js","google-travel-time-querying_files/map-1.0.0/map_layers.js","google-travel-time-querying_files/map-1.0.0/map_style.css","google-travel-time-querying_files/polylines-1.0.0/polylines.js","google-travel-time-querying_files/popper-2.6.0/popper.min.js","google-travel-time-querying_files/tippy-6.2.7/tippy-bundle.umd.min.js","google-travel-time-querying_files/tippy-6.2.7/tippy-light-border.css","google-travel-time-querying_files/tippy-6.2.7/tippy.css","google-travel-time-querying_files/tippy-6.2.7/tippy.umd.min.js","google-travel-time-querying_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
d-article > p, d-article > ul, d-article > ol{
  grid-column-end: 14;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.6.1/header-attrs.js"></script>
  <script src="../../site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
  <link href="../../site_libs/map-1.0.0/map_style.css" rel="stylesheet" />
  <script src="../../site_libs/map-1.0.0/map_events.js"></script>
  <script src="../../site_libs/map-1.0.0/legend.js"></script>
  <script src="../../site_libs/map-1.0.0/map_layers.js"></script>
  <script src="../../site_libs/map-1.0.0/charts.js"></script>
  <script src="../../site_libs/map-1.0.0/geolocation.js"></script>
  <script src="../../site_libs/google_map-binding-2.7.3/google_map.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoJtdIZ0Bms9_4w6trMp9hyoWVk5-LK4s&libraries=visualization,geometry,places,drawing"></script><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="../../site_libs/polylines-1.0.0/polylines.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Google Travel Time Querying","description":"Usage of the googleway package for travel time querying.","authors":[{"author":"Bryan Blanc","authorURL":"https://github.com/bpb824","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-15T00:00:00.000-08:00","citationText":"Blanc, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Nelson\Nygaard R Training Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Training Modules</a>
<a href="../../recipes-index.html">Recipes</a>
<a href="../../example-analyses.html">Example Analyses</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
User Resources
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../user-resources/2021-01-23-lnl-schedule/index.html">Upcoming LnL Webinar Schedule</a>
<a href="https://forms.gle/mMU2Pt3TRAoEnntPA">Request a 1-on-1 R Help Session</a>
<a href="../../user-resources/2021-01-23-nn-r-user-list/index.html">Current R Software Versions and Users</a>
<a href="../../user-resources/2021-01-23-recommended-reading/index.html">Recommended Reading List</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
R Setup
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../setup-articles/2021-01-18-using-r-locally/index.html">Setup R Locally</a>
<a href="../../setup-articles/2021-01-18-node-usage/index.html">Setup R on Node</a>
<a href="../../setup-articles-index.html">All Setup Articles</a>
</div>
</div>
<a href="../../about.html">About</a>
<a href="https://github.com/PerkinsAndWill/nn_r_training" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Google Travel Time Querying</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:geospatial" class="dt-tag">geospatial</a>
  <a href="../../index.html#category:google-apis" class="dt-tag">google-apis</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Usage of the googleway package for travel time querying.</p></p>
</div>

<div class="d-byline">
  Bryan Blanc <a href="https://github.com/bpb824" class="uri">https://github.com/bpb824</a> 
  
<br/>01-15-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#basic-usage">Basic Usage</a>
<ul>
<li><a href="#setting-up-an-api-key">Setting up an API Key</a></li>
<li><a href="#example-trip-queries">Example Trip Queries</a>
<ul>
<li><a href="#am-commute">AM Commute</a></li>
<li><a href="#pm-commute">PM Commute</a></li>
</ul></li>
</ul></li>
<li><a href="#adjusting-auto-travel-times-for-decreased-congestion-during-the-covid-19-pandemic">Adjusting Auto Travel Times for Decreased Congestion during the COVID-19 Pandemic</a>
<ul>
<li><a href="#travel-time-indices">Travel Time Indices</a></li>
<li><a href="#replica-travel-to-workschool-rate-over-2020">Replica: Travel to Work/School Rate over 2020</a></li>
<li><a href="#using-replica-to-predict-presentfuture-travel-time-indices">Using Replica to Predict Present/Future Travel Time Indices</a></li>
</ul></li>
<li><a href="#example-travel-time-adjustment-boston-ma">Example Travel Time Adjustment – Boston, MA</a>
<ul>
<li><a href="#directions-to-logan">Directions to Logan</a></li>
<li><a href="#directions-from-logan">Directions from Logan</a></li>
<li><a href="#adjusting-travel-times">Adjusting Travel Times</a></li>
</ul></li>
</ul>
</nav>
</div>
<h1 id="background">Background</h1>
<p>For those that have been using R at NN for several years, you may be familiar with querying travel times using functions in the <code>transportr</code> package – a bare bones package Bryan was saving useful functions into for NN R work. Back in 2016, when Bryan was writing a function for querying Google Directions, there was no existing package/function for doing so. In the intervening years, other packages have been developed that are more fully featured and better maintained than the corresponding functions in <code>transportr</code>.</p>
<p><strong>Going forward</strong>, it is recommended that you use the <a href="http://symbolixau.github.io/googleway/"><code>googleway</code></a> package, which provides a variety of functions for interacting with various Google Maps APIs, including querying travel times. This tutorial will demonstrate the usage of this package for querying auto travel times and then adjusting them based on travel pattern changes due to the COVID-19 pandemic. Future trainings will discuss the use of this package for querying travel times for other modes, and likely other Google APIs as well.</p>
<p>This tutorial draws upon code snippets from the <a href="http://symbolixau.github.io/googleway/articles/googleway-vignette.html"><code>googleway</code> vignette</a> – if you want a full guide to all the features of the package, please refer to that. We will focus on a couple of examples for travel time querying below.</p>
<h1 id="basic-usage">Basic Usage</h1>
<h2 id="setting-up-an-api-key">Setting up an API Key</h2>
<p>The first thing you need to do to work with Google’s APIs (<a href="https://en.wikipedia.org/wiki/API">Application Programming Interface</a>) is create your own API key so that your API calls can be tracked. Google does this because this is a service that they charge for if you do more than a couple thousand calls per day (each API has its own usage tiers). You can create your own key by going to the <a href="https://console.developers.google.com/apis/dashboard">Google Developer Console</a>, logging in with an account (I use an account linked to my NN email address), and then creating an initial API key in the ‘Credentials’ panel. It is helpful if you have multiple projects using APIs to create a key per project, as this will be easier to separate for billing purposes. You will need to provide a credit card for Google to charge to in order to use APIs – they will only charge your credit card if you go beyond the free usage tier, in which case you should be expensing those charges to a project. For practice, we shouldn’t need to go over the free usage tier.</p>
<p>After creating a key, you must enable API services tied to that key. For this tutorial, it is recommended you enable the following API services:</p>
<ul>
<li>Directions API – the main API we are using to query directions (and the travel times attached to them)</li>
<li>Maps Javascript API – the API used to generate the interactive Google map widgets used in this tutorial for visualization purposes</li>
<li>Geocoding API – this is activated so that you can insert addressed into the <code>google_directions()</code> function. Addresses and place names need to be geocoded prior to evaluation.</li>
</ul>
<p>After you enable the APIs, use the below line of code to set your API key to be used by the <code>googleway</code> package. Prior, we must load the packages we will be using in this tutorial.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>googleway</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/walkerke/tigris'>tigris</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#Using an API Key set up for NN R training -- please use your own API key oelow</span>
<span class='fu'><a href='https://rdrr.io/pkg/googleway/man/set_key.html'>set_key</a></span><span class='op'>(</span><span class='st'>'&lt;YOUR API KEY HERE&gt;'</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="example-trip-queries">Example Trip Queries</h2>
<p>Below we will demonstrate the usage of the Directions API for querying directions/travel times for an AM and PM commute from a randomly selected suburban location in Vancouver, WA to the SmartPark parking garage near Nelson\Nygaard’s office in Downtown Portland (OR). You will notice that the queried date for directions is June 1, 2021 – the query date/time must always be in the future. If you do not select a date/time, the function will default to the current time when the function is called. There is no way to query directions in the past. This date was chosen to represent an arbitrarily chosen Tuesday at some point in the future. Google’s estimates are based on historical data, but we do not know how the past months of the COVID-19 pandemic have affected that historical data being drawn upon – local judgment will have to be used when evaluating and/or adjusting these travel times.</p>
<h3 id="am-commute">AM Commute</h3>
<p>The AM commmute is assumed to depart at 7:30 am – obviously assuming for the sake of example that people are back to commuting regularly. We set the origin and destination by manually inserting the latitude/longitude coordinates of the locations – you could use an address as well, but this would need to be geocoded (which would be done behind the scenes in the function). You also select the mode (driving), hand the function a departure timestamp (coerced into POSIXct, a time format), and then specify that we want to see multiple alternatives if they exist, not just the optimal route selected.</p>
<p>We print the results of the function to show you what they look like – a list containing a lot of information including the shape of the route, the travel time, text descriptions of the steps for the route, etc. All this information is provided because people use this API for many purposes, including third-party apps that rely on the directions API to provide travel directions. You will notice that the polyline shape is returned as an encoded text string – this is a method of compressing the data for transfer over the web. You can use the <code>decode_pl()</code> function to decode the text string into a series of lat/lon vertices describing the polyline. We use several <code>map()</code> functions throughout this tutorial – if these are unfamiliar to you, please refer to the <a href="https://perkinsandwill.github.io/nn_r_training/#category:purrr">other tutorials</a> on the subject provided on this site.</p>
<p>Google directions (for the driving mode) will return a <code>duration</code> and a <code>duration_in_traffic</code> – you can interpret the <code>duration</code> as the free flow travel time, and the <code>duration_in_traffic</code> as the estimated travel time based on the predicted amount of congestion on the roadway at the query time. As we will use later on in the tutorial, we can calculate the ratio of the <code>duration_in_traffic</code> to <code>duration</code> as the <a href="https://en.wikibooks.org/wiki/Travel_Time_Reliability_Reference_Manual/Travel_Time_Reliability_Indices#:~:text=Travel%20Time%20Index%20(TTI)%20%2D,flow%20trip%20required%2026%20minutes."><strong>travel time index</strong></a> – a ratio between travel time in the congested peak and the free flow travel time. The AM commute here is predicted to be relatively uncongested given the low travel time indices (between 1 and 1.1) – this is almost certainly a COVID-19 pandemic-related effect.</p>
<p>In the final line of code below, we use the <code>google_map()</code> function to create an interative Google Map widget, on which we can plot the polylines representing our routes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dir_results_am</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_directions.html'>google_directions</a></span><span class='op'>(</span>origin <span class='op'>=</span> <span class='st'>'45.63039565205174, -122.58032084515692'</span>,
                  destination <span class='op'>=</span> <span class='st'>'45.51969205229432, -122.6822162060739'</span>,
                  mode <span class='op'>=</span> <span class='st'>'driving'</span>,
                  departure_time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>'2021-06-01 07:30:00'</span>, tz<span class='op'>=</span><span class='st'>'America/Los_Angeles'</span><span class='op'>)</span>,
                  alternatives <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>dir_results_am</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$geocoded_waypoints
  geocoder_status                    place_id          types
1              OK ChIJQ51tM3ellVQRQUSUWhU8cvA        premise
2              OK ChIJ85UqugQKlVQRD4O-PmY6nf4 street_address

$routes
  bounds.northeast.lat bounds.northeast.lng bounds.southwest.lat
1              45.6311            -122.5784             45.51934
2              45.6311            -122.5438             45.51746
  bounds.southwest.lng     copyrights
1            -122.6875 Map data ©2021
2            -122.6828 Map data ©2021
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                legs
1                        23.0 km, 23034, 23 mins, 1397, 24 mins, 1431, 740 SW 10th Ave, Portland, OR 97205, USA, 45.5197152, -122.6822678, 1205 NE Cedar Ridge Loop, Vancouver, WA 98664, USA, 45.6302853, -122.5803194, 80 m, 0.4 km, 0.9 km, 0.6 km, 1.3 km, 6.5 km, 9.4 km, 1.0 km, 0.8 km, 1.0 km, 0.3 km, 51 m, 0.3 km, 0.4 km, 45 m, 80, 367, 873, 571, 1288, 6485, 9440, 989, 810, 989, 339, 51, 286, 421, 45, 1 min, 1 min, 2 mins, 1 min, 2 mins, 4 mins, 6 mins, 1 min, 1 min, 1 min, 1 min, 1 min, 1 min, 2 mins, 1 min, 17, 80, 116, 59, 137, 240, 389, 41, 34, 42, 36, 13, 71, 104, 18, 45.63031, 45.6300293, 45.6221817, 45.623287, 45.6117051, 45.6208255, 45.5487194, 45.5408636, 45.5353545, 45.5265836, 45.5235657, 45.5231178, 45.5206867, 45.5193372, 45.5197152, -122.5813366, -122.5784834, -122.5784184, -122.5855509, -122.5856419, -122.6668709, -122.6787789, -122.6795613, -122.6863679, -122.6869077, -122.6867258, -122.6866048, -122.6875299, -122.6824859, -122.6822678, Head &lt;b&gt;west&lt;/b&gt; on &lt;b&gt;NE 12th Dr&lt;/b&gt; toward &lt;b&gt;NE Cedar Ridge Loop&lt;/b&gt;, &lt;b&gt;NE 12th Dr&lt;/b&gt; turns &lt;b&gt;right&lt;/b&gt; and becomes &lt;b&gt;NE 13th Dr&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; onto &lt;b&gt;NE 92nd Ave&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; onto &lt;b&gt;E Mill Plain Blvd&lt;/b&gt;, Turn &lt;b&gt;left&lt;/b&gt; onto &lt;b&gt;N Lieser Rd&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; to merge onto &lt;b&gt;WA-14 W&lt;/b&gt; toward &lt;b&gt;I-5&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;City Center&lt;/b&gt;, Take the exit on the &lt;b&gt;left&lt;/b&gt; onto &lt;b&gt;I-5 S&lt;/b&gt; toward &lt;b&gt;Portland&lt;/b&gt;&lt;div style=&quot;font-size:0.9em&quot;&gt;Entering Oregon&lt;/div&gt;, Take exit &lt;b&gt;302B&lt;/b&gt; for &lt;b&gt;I-405&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;US-30 W&lt;/b&gt; toward &lt;b&gt;Beaverton&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;St. Helens&lt;/b&gt;, Continue onto &lt;b&gt;I-405 S&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;US-30 W&lt;/b&gt;, Keep &lt;b&gt;left&lt;/b&gt; to continue on &lt;b&gt;I-405 S&lt;/b&gt;, follow signs for &lt;b&gt;US-26 W&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;City Center&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;Beaverton&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;Glisan St&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;Everett St&lt;/b&gt;, Take exit &lt;b&gt;2 A&lt;/b&gt; for &lt;b&gt;Couch St&lt;/b&gt; toward &lt;b&gt;Burnside St&lt;/b&gt;, Continue onto &lt;b&gt;NW 15th Ave&lt;/b&gt;, Continue straight onto &lt;b&gt;S 15th Ave&lt;/b&gt;, Turn &lt;b&gt;left&lt;/b&gt; onto &lt;b&gt;S Yamhill St&lt;/b&gt;, Turn &lt;b&gt;left&lt;/b&gt; after Jimmy John&#39;s (on the left)&lt;div style=&quot;font-size:0.9em&quot;&gt;Destination will be on the right&lt;/div&gt;, idouG~mdkV@bB?t@?L@JAB?@?B?@AB?@A@?@A@, mdouGjtdkVG@G@G?_@@IAE?CAKCIIIKGIEMK]Ig@E]AEAYCg@?a@@]B[D]BUBG@IFMDMFIJMHIJGHEJCJA|@AT?D?BCBC@C@A@KA[?s@, ubouGnbdkV~ACdACf@Ah@?fAAP?xA@r@Al@?rA@N?xB?hC@`@?`BCfC@V@pA@~A?x@AzCC, sqmuGbbdkV[bCs@zFB`@g@~D]fDGx@IpAMtBIdBC`@OfCMtB, qxmuGtnekVv@?`@?jA@tB@jFBt@?`A?T?d@?J?`FDvA?rB?b@?b@An@?X?Z?b@?VBrACVAd@AdA?dA?bA@fA?b@?pB?J?ZAX@r@Cz@DhABn@?~@@, epkuGfoekV?h@@t@?r@Ap@?p@?v@Ab@?JANAV?JAPC\\I|@QdB?BAB?D@B@BDH_@jCGd@Ip@Ih@QbBMvAI|@Eb@Gx@Ch@Gz@Ev@KdCAL]tIg@pMKhCIzBIzAIvAGp@Gt@K|@Mz@U`BeBzKc@nCm@~D}@pFO`AETOjAM`ASrBQ~CGzAAx@Al@Ar@?dEA`AAx@Ct@OpCGv@A@K~@O|@SpA}CxNo@zCWfAMZa@rBw@~DSdASjACHKn@Ib@_@jCUdBQzACTW`CIdAGr@UtCOlBMbCABItBEtAEbBEdB?LA`BAxA?lDB|DD`G?tN?fBAnMAzS?d@@hEBrGNdR@xA?fD@dB@rE@rC@lE?pC?`@?L?T?z@?tA@`G@lBAtAAbCA\\?RCrAAh@ErAAZCp@GlAE`AGdAItAC\\KjAARCXq@vG]vCKx@It@Gl@Il@CVKz@Kx@O~@ObAMr@UhAS|@WhASv@CFMf@Wz@Ob@Sl@O`@Uj@, eimuG|jukVOb@M\\c@bA_@z@cArBm@hAw@|AWd@Ub@?@A@Ud@KXGLMTWh@Q`@CFS`@Sf@Sh@EJABABM\\CDELCB?@Sh@GNGNKVMPGJEFEFGFKHOFKBI@I?MAIAICMIIGGIIKGMEIEMCKCKAMAM?MAm@DUBKDIBIDGHMDGFEFGNILCF?FAJ?D?D@HBFBDBDBDBDFNPfAxALNT\\\\b@@@@@D@RJb@n@f@p@JJDFNPTTPPTNVTRHPJNH?@@?DBLH@?@@B@DB@@JF~@f@fEtB`Af@?@jIdEbBz@^P`@R^R`@R`Af@l@XTJbCnA`Af@`@PvAt@h@Vf@Vb@TVLNHHDZNRJRJZLJFD@ZNFBD@ZN\\LrB`AZLLF`Bp@xAl@`Br@b@T^RhAj@fAl@vAp@^T@?HDTLPFpBbApBbAbDpA@?fCx@B?PFLDj@Jj@JjCh@b@Jb@HLBVFB??@VD@?b@JXDzDv@h@JfAVh@JtAX\\JjF`AxEz@zAX`@DTDz@HtAFz@BX?P?N?T?dBEr@Kj@IdASf@K`A[LCf@OXKtCeAzJiDfDmAVI|@]|@Wz@[nBq@jAc@r@UdCy@hBm@d@S@?h@Ux@YjDoAlC_AfC}@vAg@XKLC\\KjAY|A[nAQtCWLAR?R?b@Ab@?b@?jB?`B?vC@J?p@Ar@?rC@lC?\\@hCBfAA|@@h@?dD@~B?`F@f@?tC?hF?rDCR?B?lDAb@?lBAv@?jA@tC@~AA@?rA@lC@xA?D?JAB?|FAx@A|AAtCCfQEhEBlC@hA?F?nA@`A?D@H?@?`ABJ?x@@L?J?lB?zCEzA?hC@fDBfC@nC@b@@bD@~C@, of_uGjuwkVNNB?BBB?f@?T?`A@J?B?X?LAV?F?ZCHA@?VETE^KXKDARIBANIPIBC@ALGNKDEROROJIBCXUXUDCBCVS@ADCLKj@c@b@_@FEBENKVQBAVQPKHEBAXK\\KLAHCTCB?P?VAP@J@VF`@LB?PHHFHD@@DDLHHHDBDBLLBDJLFFDD@Bh@r@JNBBV\\v@`Ad@j@PRX\\NPJN@@V\\?@Z\\LLRXPZ, ku}tGfzwkVBFHL@@HJDF@B`OxRdKpMJP@@?@nAzAb@p@`@p@, }r|tGxdykVTDRJVXXVLHRLPJTJZJRDXHLBRDN@TBd@@H?@?tACzAA`@?bAC@?@?b@Ab@AB?^?\\A@?B?H?X?N@b@?p@@Z?^@^?jBEF?ZAxAChAEnAE`BCrAEVCn@?FAH?hAC, c|ztGdhykVJDF@VBZ?d@DdAFn@Bp@@z@A~@IxASdASf@O, iiztG`gykVb@IDA@?BAHA^I, ofztGffykVn@Md@EN?@?B@@?DBbAb@`@P\\N`Ab@`@RDB`A`@TJd@RDB, iwytG`lykVLs@X_BLo@N{@Nu@?CLo@Hk@X_BXeBJm@Hc@ZqB@Kj@uCJm@, {nytGplxkVGEcAe@, 45.6302853, 45.63031, 45.6300293, 45.6221817, 45.623287, 45.6117051, 45.6208255, 45.5487194, 45.5408636, 45.5353545, 45.5265836, 45.5235657, 45.5231178, 45.5206867, 45.5193372, -122.5803194, -122.5813366, -122.5784834, -122.5784184, -122.5855509, -122.5856419, -122.6668709, -122.6787789, -122.6795613, -122.6863679, -122.6869077, -122.6867258, -122.6866048, -122.6875299, -122.6824859, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, NA, NA, turn-right, turn-right, turn-left, ramp-right, ramp-left, ramp-right, NA, keep-left, ramp-right, NA, straight, turn-left, turn-left
2 24.9 km, 24852, 24 mins, 1443, 26 mins, 1562, 740 SW 10th Ave, Portland, OR 97205, USA, 45.5197152, -122.6822678, 1205 NE Cedar Ridge Loop, Vancouver, WA 98664, USA, 45.6302853, -122.5803194, 80 m, 0.4 km, 0.9 km, 1.1 km, 10.9 km, 8.7 km, 0.6 km, 0.6 km, 0.5 km, 0.5 km, 0.3 km, 0.2 km, 0.1 km, 80, 367, 873, 1135, 10921, 8714, 564, 640, 458, 451, 318, 203, 128, 1 min, 1 min, 2 mins, 2 mins, 7 mins, 6 mins, 1 min, 1 min, 1 min, 2 mins, 1 min, 1 min, 1 min, 17, 80, 116, 124, 413, 340, 27, 36, 34, 92, 73, 52, 39, 45.63031, 45.6300293, 45.6221817, 45.6209459, 45.5352424, 45.5253795, 45.5222374, 45.5175021, 45.5191946, 45.5206901, 45.5180094, 45.5186617, 45.5197152, -122.5813366, -122.5784834, -122.5784184, -122.5642229, -122.5642567, -122.661762, -122.6657025, -122.6681931, -122.6735329, -122.6789108, -122.6803394, -122.6827699, -122.6822678, Head &lt;b&gt;west&lt;/b&gt; on &lt;b&gt;NE 12th Dr&lt;/b&gt; toward &lt;b&gt;NE Cedar Ridge Loop&lt;/b&gt;, &lt;b&gt;NE 12th Dr&lt;/b&gt; turns &lt;b&gt;right&lt;/b&gt; and becomes &lt;b&gt;NE 13th Dr&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; onto &lt;b&gt;NE 92nd Ave&lt;/b&gt;, Turn &lt;b&gt;left&lt;/b&gt; onto &lt;b&gt;E Mill Plain Blvd&lt;/b&gt;&lt;div style=&quot;font-size:0.9em&quot;&gt;Pass by 7-Eleven (on the right in 450&amp;nbsp;m)&lt;/div&gt;, Merge onto &lt;b&gt;I-205 S&lt;/b&gt; via the ramp to &lt;b&gt;Salem&lt;/b&gt;&lt;div style=&quot;font-size:0.9em&quot;&gt;Entering Oregon&lt;/div&gt;, Take exit &lt;b&gt;21B&lt;/b&gt; to merge onto &lt;b&gt;I-84 W&lt;/b&gt;/&lt;wbr/&gt;&lt;b&gt;US-30 W&lt;/b&gt; toward &lt;b&gt;Portland&lt;/b&gt;, Take the &lt;b&gt;I-5 S&lt;/b&gt; exit on the &lt;b&gt;left&lt;/b&gt; toward &lt;b&gt;Salem&lt;/b&gt;, Keep &lt;b&gt;right&lt;/b&gt;, follow signs for &lt;b&gt;City Center&lt;/b&gt;, Continue onto &lt;b&gt;SE Morrison Bridge&lt;/b&gt;, Continue onto &lt;b&gt;SW Washington St&lt;/b&gt;, Turn &lt;b&gt;left&lt;/b&gt; onto &lt;b&gt;SW Broadway&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; onto &lt;b&gt;S Taylor St&lt;/b&gt;, Turn &lt;b&gt;right&lt;/b&gt; onto &lt;b&gt;SW 10th Ave&lt;/b&gt;&lt;div style=&quot;font-size:0.9em&quot;&gt;Destination will be on the right&lt;/div&gt;, idouG~mdkV@bB?t@?L@JAB?@?B?@AB?@A@?@A@, mdouGjtdkVG@G@G?_@@IAE?CAKCIIIKGIEMK]Ig@E]AEAYCg@?a@@]B[D]BUBG@IFMDMFIJMHIJGHEJCJA|@AT?D?BCBC@C@A@KA[?s@, ubouGnbdkV~ACdACf@Ah@?fAAP?xA@r@Al@?rA@N?xB?hC@`@?`BCfC@V@pA@~A?x@AzCC, sqmuGbbdkVVAZ{BNaAd@uDf@_ERcBL_AHs@RmBJw@Fa@?CBWBWBWDq@@u@?mB?iA?kA@m@?iF?eC?kD?kAAwF?i@Ag@?sAAyA?W@{A?sAAs@, }imuGjiakVFYBSBmM@aA?a@Be@Be@B[BOBOBGBKDMFMHQFMHIJMJIFEZSXS`C{At@e@^S^UTQDGBA@E@C@EZQPMPKRQ|AuAJKZ]\\]NOdAaAJQBG@G?E?GlAcA|@w@pAoAtEgE^]DCNOVU^[FG^Yp@c@h@[`@Sl@]n@Y|@]zAc@bAWFA~@QZKpBQ^ElBQtAOnIu@fHo@B?^En@Gb@Eb@EjBQ~BSvAOf@GZCTCh@EjCSb@CDATAJAfAIfAKfAIrAKv@KNCB?HAfBS\\Eh@I`AMBA`BWfAQ`@G|Ba@NE`@IhB_@b@M`@KFA`Bc@nBi@x@Wh@S|Ak@fBo@@A\\O`@Q`@O`@QHCVM`@Q~@c@@A`@Sv@a@j@YvAu@jAo@`Ag@`Ai@`Ag@^S`@S^SxBkAfAk@BAZODCZOBCPGNILGRKNGPIJETK^O?A`@OBA\\O`@OZMh@QbA[p@S^KZIFAXGNE~@SXEr@KZGLCPCLA|@MTCTA`@EFATADAb@Cn@Ef@Ad@CP?N?v@AB?^AL?T?b@@@?r@@N?j@Bh@@T@`AFfAJNBZBD@r@JRBRBNBj@Jv@NB@`ATD@bAVfAZzAf@HBZJd@Lf@RPFr@ZLFbAf@B@|A|@ZRh@^b@XPL@BVPPHv@b@r@f@ZTJJ?@LJn@l@~@z@t@t@^`@|@`ApA`BdB|BPT^j@T\\@??BFHxCnEpAnBTZvB`DlF~HzA|BX^~@xAJLbBdCT\\`@j@~@xA`@l@xAvBbClDnDfF\\f@^h@r@fA~@rAz@vANTjAnBFJdBrCj@|@l@~@|@tAn@|@`@l@LRxArBhAvAb@f@r@r@d@`@LLvBnArAp@xAd@TFPDLBj@Jf@FRBf@@d@?@?TARAVA\\Ep@Ih@K`AS^Ob@Mx@[p@]XMTOp@e@d@a@v@o@b@c@VW^c@h@q@r@cAb@s@`@q@xBmD~@yA~AeCj@w@|@cAz@{@b@Yv@e@|@g@h@Q\\Mh@MZILCf@IB?n@Eb@C@?VAt@?T@lAJp@Jp@L\\J`@LXHlA`@`@N`@LnEzAxAb@jCx@l@N|FzAlB`@`AR~Bd@n@JnCd@zIxAhHjA, gr|tGriakVVTFBDBVJz@TpA^@?B@HBLD@?TFPFd@PRJJFFDJFTRXVPNNP`@f@V`@LPHRBFDHN^Xr@\\lAXhA@DPz@BJX|AHn@Hn@J|@Fp@Jb@Bn@BZBvA?\\@|AAp@?p@A^C`BADMlCMbBUlBKr@[fBKf@Or@K\\IT_ApDgDnNWbAk@xBg@|BMf@gAdEiAxDi@dBo@dCS`AOt@]lBOlAMlAC^Ch@Ar@CnA?f@?T@Z@f@B`@?f@@JJ~APjBPtAZhB^xADRJXTt@jCzGPb@bB`E?@Zt@lBlEtGtOTl@Th@~DtJFN\\x@hBjEfAbCnArC@BLZBBHRlAvCj@dBTt@HZNh@H\\FZFVF`@@@Hd@D`@NdADh@Fl@Dr@Dx@BjA@t@@l@?h@A^Af@Ev@Cj@Ep@?@AXANE`@AREXE`@Kt@Kl@Id@G\\Qp@c@xAw@rB{@fBw@tAcAhBsCfFg@x@e@z@s@nAk@bAi@dAKPSb@Sb@[x@Qd@Un@Sp@[lAOr@Q~@Ox@CPMt@OdAU|AEVIh@?@c@~CKr@Kn@?@UxAYtBKt@?@ABIf@G`@In@Kn@_@rC[pBU|A?@Gb@g@pD]`COjAGr@IjACj@Cz@?b@?`@Bh@Bj@B`@Df@@?Ff@Jj@Jf@DNFTZbADR\\r@\\j@V^^d@v@z@TTnA`AfBxARNf@f@p@t@\\h@^l@Zn@DHRh@Nd@H\\FTFb@DX@?Db@DV@ND^B`@Bb@Bd@DvA?V@@D|BL`GLfGP|KHjEHpD@pA?@@FB`BFzD?N?`@JpD?F@XDn@LbBVlCB\\@FvAxI@@l@vDb@fCfAxGBL?B?@?@@?`@|BVjA?B^`Bh@vBXbAbA`Dv@|BHTlA|C\\z@Th@DL`A`CRj@Tn@HV?@BFJ\\FZDPF`@FTBH@F@HBl@, stztG~jtkVF`B@n@?FAhC@\\?@@LDv@@J?@D\\Hb@FRFV?@FPHPHVFJBFB@Xh@FJVVTTRPDBXNXJB@@?VH^Fl@FN@V?dAAB?L?v@B@?nAB, _aztGrcukV`@P^H^Jf@RFBd@JNBb@JNBPDb@JNBPDb@J`@HPDNB@@VDTBJBN?N@`@CL?VCdAI`AMZAR?N@RD^PNJVXHHLZHPDNDNFn@@XAb@Ad@Cx@, kcytGdsukVs@~DWxAAD[bBk@fDER?@CNI`@[xA]xAOn@KXK^IRGNSl@Ob@Ob@, }mytGptvkVW|@Kh@Y|AOx@Q|@g@nCq@|DAFI`@e@rCG\\AFMn@ShACLCJCLAFEX, iwytGdvwkVdCdAbCdABBNFdBr@@?HDD@\\P`@P`Ad@, qfytGb_xkVKn@g@rC]nBo@pD, sjytGhnxkVCHg@ScAc@WIGEcAe@, 45.6302853, 45.63031, 45.6300293, 45.6221817, 45.6209459, 45.5352424, 45.5253795, 45.5222374, 45.5175021, 45.5191946, 45.5206901, 45.5180094, 45.5186617, -122.5803194, -122.5813366, -122.5784834, -122.5784184, -122.5642229, -122.5642567, -122.661762, -122.6657025, -122.6681931, -122.6735329, -122.6789108, -122.6803394, -122.6827699, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, DRIVING, NA, NA, turn-right, turn-left, ramp-right, ramp-right, ramp-left, keep-right, NA, NA, turn-left, turn-right, turn-right
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                points
1                                                                                                                                                                                                                                                                                idouG~mdkV@~DCFIDy@@IAUMQUQk@OeAC_@CiADy@NeAL[RWTQTIdBCJM?g@?s@~AClBEpBAlE?fJBbH?pD@tEEoA~JB`@g@~De@`FWfEk@dKzGBxJBjJDjFAt@?z@BvEGtF@rD?r@Cz@DxBB~@@?h@@t@AnEEvAOxBSrBBFDH_@jCQvA[lCe@rF]bHsA~\\SvEQhCSrBc@|CuF|]s@dFe@rGItCEhJEnBWhE]~BSpAmEtSWfAMZyArHw@jEi@nDg@`Em@pGu@jKOjEKhEAnBAfGH~L?|QAzi@Tzb@FzS@jR?bEC`DKdFS|Ea@dGEl@oAnLg@jEk@lE]vBi@fC}@pDkAnDwApDcBnDeBfDm@jAc@`A_AnB_AzBa@dAWn@i@hA[b@[PUDWASEWQQUWq@Gu@Am@DUHUXg@NM\\M`@A\\L`@`@hCjD\\P|AtBlAhAbBdANHn_@lRlMrGjCnAdAd@zDdB|GrClCtA~C~A`@TbD~ApBbAbDpAhCx@b@LbF`AlB`@zAXvIfBrBd@dM|B|B^pANpCJj@?d@?dBEr@KpB]hBg@dFeBzPaGzBu@jDmAnJaDpAi@zNgF~Bw@hBe@lDm@bDYf@?vEAjTBhCBdC?pPB|D?|KCdEAtG?jI@xF?xKE|UIhEBnHBhFFxB?vFEhQHfEB~C@NNFBj@?fB@fAA~@Kt@Q^Mx@_@b@YvBcBhCsBn@e@r@c@\\Mj@Mt@Gh@?b@Hd@LZP^Vb@^xAlB~D`F`AjAr@jARX`OxRdKpMLRnA|AdAbBTDRJp@p@hAn@hAZfANfCAdEEnCEdFDhFKnIUxAEhACJD^D`ADtBJlB?~@IxASdASf@Oh@KDAh@Kn@Md@EP?D@hChAjD|Az@^DBLs@f@oC^qBp@_EjAiHl@aDJm@GEcAe@
2 idouG~mdkV@~DCFIDy@@IAUMQUQk@OeAC_@CiADy@NeAL[RWTQTIdBCJM?g@?s@~AClBEpBAlE?fJBbH?pD@tEEVAZ{Bt@wFrAwKf@kEPyB@cD?uC@iQCwTAgCJm@DoOBgANaBTo@P_@TWhAw@vFkD`@a@BIl@_@d@]hBaBnCmCNY@M?GlAcAnCgCjGyF~AsAzA_AnAq@lBw@~C{@fASZKpBQlCWdLeAjHo@zMoArHm@nBOnCUjCW\\EnDc@nFy@pEy@vD{@pEmAbBk@dFmBnBw@zBeA|EeCrJeFxGiDtCqAbAc@jDkAtBk@bCg@nB[vBUdAKzBKfEGhBBlDNxBTjBVhDr@hAXbDbArBp@vCrA`B~@dAr@nA|@hAl@r@f@t@n@dD~C|AbBvD~EfA~AbD|EnSrZzEhHnLzPpDlF~ChFpCpEjBtCxDrFlB~BxAtAdC|ArAp@xAd@f@Lx@Nz@JlA@bAEnAOjB_@bA]jBy@n@]vAgAzAsAv@{@|AuBdAeBxDgGjC}DxB_CzA_A|@g@h@QfA[h@Mj@IrAInAAbBLbBXfDdAlJ|CxDhA|FzAlB`@`Ex@~Dp@dSdD^X\\NlCt@\\JnA`@r@`@pAlAx@hAVd@r@dBv@vCR`A\\hBR~ARnBJb@Bn@FrB@zBGdFOrCMbBUlBg@zC[zAUr@gF`TkBzHuAlFsB~GcAfEm@bD]zCGhAEbC?|@FlCLjBb@`Ez@bEPl@`DpItBdF~KzWrF|MnH|PLVlAvCj@dBTt@XdA`@rB`@nCLvAJlBD`C@vACfAIbBI|ASpBi@fDu@jCw@rB{@fB{B~D{D`HoDtGoArCg@tAo@~Bu@~DsBpNkEpZeArHW~BMvBC~ABjAFlAZzBPv@b@xADR\\r@t@jAvA`BdBvAzBhBxA|A|@vA`@x@b@nAPr@T`BPhBLxDb@hSt@tc@JjFFhAd@pF~A`K|CfRz@pE^dBbAzDzB~GvArDzBtFr@tB\\rAThADv@HpC?pDHrAN`ANj@Z|@h@~@^b@h@f@^R\\Lx@P|@H|AAhABpAB`@P^HfA^l@NtAXnDv@hALp@Ad@CfCWn@Ab@Fn@\\`@b@Vl@J^HhAChACx@s@~DY~AgAjGSfAuA|Fq@pB_@fAc@fBcBdJcBzJy@nEEXdCdAfChA`C`AfCjAaCdNCHg@S{Am@kAk@
             summary warnings waypoint_order
1  WA-14 W and I-5 S     NULL           NULL
2 I-205 S and I-84 W     NULL           NULL

$status
[1] &quot;OK&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tt_frame_am</span> <span class='op'>=</span> <span class='va'>dir_results_am</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>legs</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tibble</span><span class='op'>(</span>legs <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>legs</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='fu'>contains</span><span class='op'>(</span><span class='st'>'duration'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>duration_minutes_no_traffic <span class='op'>=</span> <span class='va'>duration</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span>,
         duration_minutes_with_traffic <span class='op'>=</span> <span class='va'>duration_in_traffic</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span>

<span class='va'>polys_am</span> <span class='op'>=</span> <span class='va'>dir_results_am</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>overview_polyline</span><span class='op'>$</span><span class='va'>points</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span>poly<span class='op'>=</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>decoded_poly <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>poly</span>,<span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/decode_pl.html'>decode_pl</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>tt_frame_am</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>map_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'Alternative #'</span>,<span class='va'>alternative_num</span>,<span class='st'>': '</span>,
                            <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>duration_minutes_with_traffic</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='st'>' minutes with traffic'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>tti <span class='op'>=</span> <span class='va'>duration_minutes_with_traffic</span><span class='op'>/</span><span class='va'>duration_minutes_no_traffic</span><span class='op'>)</span>

<span class='co'>#See what the travel time indices are</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>polys_am</span><span class='op'>$</span><span class='va'>tti</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.024338 1.082467</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_map.html'>google_map</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>polys_am</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/add_polylines.html'>add_polylines</a></span><span class='op'>(</span>polyline <span class='op'>=</span> <span class='st'>'poly'</span>,stroke_weight <span class='op'>=</span> <span class='fl'>9</span>,mouse_over <span class='op'>=</span> <span class='st'>'map_label'</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:google-map-am-trip"></span>
<div id="htmlwidget-96b61d9be84459109bcd" style="width:768px;height:576px;" class="google_map html-widget"></div>
<script type="application/json" data-for="htmlwidget-96b61d9be84459109bcd">{"x":{"lat":-37.9,"lng":144.5,"zoom":8,"styles":null,"search_box":false,"update_map_view":true,"zoomControl":true,"mapTypeControl":true,"scaleControl":false,"streetViewControl":true,"rotateControl":true,"fullscreenControl":true,"event_return_type":"list","split_view":null,"split_view_options":{"heading":34,"pitch":10},"geolocation":false,"calls":[{"functions":"add_polylines","args":[[{"mouse_over":"Alternative #1: 23.9 minutes with traffic","id":1,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["idouG~mdkV@~DCFIDy@@IAUMQUQk@OeAC_@CiADy@NeAL[RWTQTIdBCJM?g@?s@~AClBEpBAlE?fJBbH?pD@tEEoA~JB`@g@~De@`FWfEk@dKzGBxJBjJDjFAt@?z@BvEGtF@rD?r@Cz@DxBB~@@?h@@t@AnEEvAOxBSrBBFDH_@jCQvA[lCe@rF]bHsA~\\SvEQhCSrBc@|CuF|]s@dFe@rGItCEhJEnBWhE]~BSpAmEtSWfAMZyArHw@jEi@nDg@`Em@pGu@jKOjEKhEAnBAfGH~L?|QAzi@Tzb@FzS@jR?bEC`DKdFS|Ea@dGEl@oAnLg@jEk@lE]vBi@fC}@pDkAnDwApDcBnDeBfDm@jAc@`A_AnB_AzBa@dAWn@i@hA[b@[PUDWASEWQQUWq@Gu@Am@DUHUXg@NM\\M`@A\\L`@`@hCjD\\P|AtBlAhAbBdANHn_@lRlMrGjCnAdAd@zDdB|GrClCtA~C~A`@TbD~ApBbAbDpAhCx@b@LbF`AlB`@zAXvIfBrBd@dM|B|B^pANpCJj@?d@?dBEr@KpB]hBg@dFeBzPaGzBu@jDmAnJaDpAi@zNgF~Bw@hBe@lDm@bDYf@?vEAjTBhCBdC?pPB|D?|KCdEAtG?jI@xF?xKE|UIhEBnHBhFFxB?vFEhQHfEB~C@NNFBj@?fB@fAA~@Kt@Q^Mx@_@b@YvBcBhCsBn@e@r@c@\\Mj@Mt@Gh@?b@Hd@LZP^Vb@^xAlB~D`F`AjAr@jARX`OxRdKpMLRnA|AdAbBTDRJp@p@hAn@hAZfANfCAdEEnCEdFDhFKnIUxAEhACJD^D`ADtBJlB?~@IxASdASf@Oh@KDAh@Kn@Md@EP?D@hChAjD|Az@^DBLs@f@oC^qBp@_EjAiHl@aDJm@GEcAe@"]},{"mouse_over":"Alternative #2: 26 minutes with traffic","id":2,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["idouG~mdkV@~DCFIDy@@IAUMQUQk@OeAC_@CiADy@NeAL[RWTQTIdBCJM?g@?s@~AClBEpBAlE?fJBbH?pD@tEEVAZ{Bt@wFrAwKf@kEPyB@cD?uC@iQCwTAgCJm@DoOBgANaBTo@P_@TWhAw@vFkD`@a@BIl@_@d@]hBaBnCmCNY@M?GlAcAnCgCjGyF~AsAzA_AnAq@lBw@~C{@fASZKpBQlCWdLeAjHo@zMoArHm@nBOnCUjCW\\EnDc@nFy@pEy@vD{@pEmAbBk@dFmBnBw@zBeA|EeCrJeFxGiDtCqAbAc@jDkAtBk@bCg@nB[vBUdAKzBKfEGhBBlDNxBTjBVhDr@hAXbDbArBp@vCrA`B~@dAr@nA|@hAl@r@f@t@n@dD~C|AbBvD~EfA~AbD|EnSrZzEhHnLzPpDlF~ChFpCpEjBtCxDrFlB~BxAtAdC|ArAp@xAd@f@Lx@Nz@JlA@bAEnAOjB_@bA]jBy@n@]vAgAzAsAv@{@|AuBdAeBxDgGjC}DxB_CzA_A|@g@h@QfA[h@Mj@IrAInAAbBLbBXfDdAlJ|CxDhA|FzAlB`@`Ex@~Dp@dSdD^X\\NlCt@\\JnA`@r@`@pAlAx@hAVd@r@dBv@vCR`A\\hBR~ARnBJb@Bn@FrB@zBGdFOrCMbBUlBg@zC[zAUr@gF`TkBzHuAlFsB~GcAfEm@bD]zCGhAEbC?|@FlCLjBb@`Ez@bEPl@`DpItBdF~KzWrF|MnH|PLVlAvCj@dBTt@XdA`@rB`@nCLvAJlBD`C@vACfAIbBI|ASpBi@fDu@jCw@rB{@fB{B~D{D`HoDtGoArCg@tAo@~Bu@~DsBpNkEpZeArHW~BMvBC~ABjAFlAZzBPv@b@xADR\\r@t@jAvA`BdBvAzBhBxA|A|@vA`@x@b@nAPr@T`BPhBLxDb@hSt@tc@JjFFhAd@pF~A`K|CfRz@pE^dBbAzDzB~GvArDzBtFr@tB\\rAThADv@HpC?pDHrAN`ANj@Z|@h@~@^b@h@f@^R\\Lx@P|@H|AAhABpAB`@P^HfA^l@NtAXnDv@hALp@Ad@CfCWn@Ab@Fn@\\`@b@Vl@J^HhAChACx@s@~DY~AgAjGSfAuA|Fq@pB_@fAc@fBcBdJcBzJy@nEEXdCdAfChA`C`AfCjAaCdNCHg@S{Am@kAk@"]}],true,"defaultLayerId",true,false,0,false]}]},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 1: Example AM Commute Routes
</p>
</div>
</div>
<h3 id="pm-commute">PM Commute</h3>
<p>We also do the same calculations as done above for the PM commute. Here we see there is much more of a congestion effect (travel time indices of 1.5-1.7)– I am not sure how to explain this, but would love to indulge theories! We also see the best route in the PM is using I-205, whereas I-5 was the faster route during the AM commute.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dir_results</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_directions.html'>google_directions</a></span><span class='op'>(</span>destination <span class='op'>=</span> <span class='st'>'45.63039565205174, -122.58032084515692'</span>,
                  origin <span class='op'>=</span> <span class='st'>'45.51969205229432, -122.6822162060739'</span>,
                  mode <span class='op'>=</span> <span class='st'>'driving'</span>,
                  departure_time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>'2021-06-01 17:15:00'</span>, tz<span class='op'>=</span><span class='st'>'America/Los_Angeles'</span><span class='op'>)</span>,
                  alternatives <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>tt_frame_pm</span> <span class='op'>=</span> <span class='va'>dir_results</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>legs</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tibble</span><span class='op'>(</span>legs <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>legs</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='fu'>contains</span><span class='op'>(</span><span class='st'>'duration'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>duration_minutes_no_traffic <span class='op'>=</span> <span class='va'>duration</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span>,
         duration_minutes_with_traffic <span class='op'>=</span> <span class='va'>duration_in_traffic</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span>

<span class='va'>polys_pm</span> <span class='op'>=</span> <span class='va'>dir_results</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>overview_polyline</span><span class='op'>$</span><span class='va'>points</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span>poly<span class='op'>=</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>decoded_poly <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>poly</span>,<span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/decode_pl.html'>decode_pl</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>tt_frame_pm</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>map_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'Alternative #'</span>,<span class='va'>alternative_num</span>,<span class='st'>': '</span>,
                            <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>duration_minutes_with_traffic</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='st'>' minutes with traffic'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>tti <span class='op'>=</span> <span class='va'>duration_minutes_with_traffic</span><span class='op'>/</span><span class='va'>duration_minutes_no_traffic</span><span class='op'>)</span>

<span class='co'>#See what the travel time indices are</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>polys_pm</span><span class='op'>$</span><span class='va'>tti</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.478261 1.617716</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_map.html'>google_map</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>polys_pm</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/add_polylines.html'>add_polylines</a></span><span class='op'>(</span>polyline <span class='op'>=</span> <span class='st'>'poly'</span>,stroke_weight <span class='op'>=</span> <span class='fl'>9</span>,mouse_over <span class='op'>=</span> <span class='st'>'map_label'</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:google-map-pm-trip"></span>
<div id="htmlwidget-dffc1301ef47f6b37fc5" style="width:768px;height:576px;" class="google_map html-widget"></div>
<script type="application/json" data-for="htmlwidget-dffc1301ef47f6b37fc5">{"x":{"lat":-37.9,"lng":144.5,"zoom":8,"styles":null,"search_box":false,"update_map_view":true,"zoomControl":true,"mapTypeControl":true,"scaleControl":false,"streetViewControl":true,"rotateControl":true,"fullscreenControl":true,"event_return_type":"list","split_view":null,"split_view_options":{"heading":34,"pitch":10},"geolocation":false,"calls":[{"functions":"add_polylines","args":[[{"mouse_over":"Alternative #1: 34.6 minutes with traffic","id":1,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["gqytGdkxkViAk@_Bo@SO@GLw@`AgFdBoKnCsOdAyGHmALsCHoAZwCd@aDfC}NnBqKJuAI}@Mc@Q[a@[c@Mi@D]NmAfAu@\\_@F_@?WGm@QqAc@yBk@aAOkCc@gH@oCG}@Ga@G_A]g@]e@g@i@_AWo@Ke@QeAI{@c@kGIq@W_BWaAa@uAC_@}@}Bo@}As@aB{BmGwAoEk@{By@cEs@aEACqC{PwAaJQyAKwAIcBKwEMaI_Aqi@IsDImCMsBYuBg@qB{@sB]m@oAyAiBiBiCsBo@o@k@s@y@oAq@_BSo@YqA]qCGyB@iAN}Ct@_GLw@PgAhB_NXmBdBqLp@yEbAoGn@mCn@qBv@iBnAcCxGuLxDgHlAsCz@uC^gB`@{CNaCJkD?eDG}AKkBQoBYgBW{As@iCK]m@eBcAcCKUMYoFeMeC}FqGuOkIeSwC{GuAqDk@mBWoA[yA]wCOgCC{@CoA?wBHmBLoB^{Cr@kDd@cBnAcEhBcHtBqItFkUv@uDXaBf@gEVyELwG[kHM}Ac@eDk@cDs@aDi@mBQa@Sc@[s@gAeCm@oAwBoDw@iAmA_Bu@}@oAoAkBwA{A{@{Aq@uAc@wAY_AOyAKkDQ_BGa@MaCYwCa@cCa@sCc@sAKyAA{@Fq@JyB`@}EhA{Dj@eCX_@Ts@LgATeBj@q@XoAx@g@^gAbAiAhAkBtCgC`EgBvCeBjCcAnA]^{@v@yA~@u@`@m@XmCl@wAR{@Dm@?uAEaAMqAY_AYoAi@mAs@w@m@cAaAoAyAqJgNuDoFyIiMyIgMqGeJqKsOm@cAe@i@s@cA_DqEiCkD}AoB_CqCuAyA}AyAuAsAgByA}@q@q@i@e@YwA}@uAq@sAq@a@QyD_BmDeAeCg@mCc@aEa@gCM}@AeAA_DBoCLaDXiANqDl@cDz@iCz@gCbAcBv@_GvCqHtDqHxD_CdAiDtAgC`AkE|A_EfAgCl@kDp@{GdAcD^{Gn@uKbAyBRyLbAqGj@mL`AiF`@gBXiB^gAZ{@^wBbAqAt@}BfBo@j@uCjC}@Ty@l@gDvCgA~@mC|Ba@ZkBlAmAn@w@\\aBh@}@VsB`@gANqALo@MUI]_@Si@Eg@Ag@Fa@Tq@PS^SZAN@^RRVJZPt@RzA?~@?bB?vABnH?~QBnP@fKAjUCxA[jDkAfJ{AlL[`C{CByC@iBCiF@uHAoGAkDBeDF@nACLEFIBsA@WDULUVMVQt@Ix@A~@D`AFb@TdALVRTNDv@?PG@C@_BAcB"]},{"mouse_over":"Alternative #2: 34.7 minutes with traffic","id":2,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["gqytGdkxkVu@a@GCCPu@`EYlB_AfFm@jDY|AeBy@{@]mCoA_@Ok@CUBMFoAzA_@^w@r@q@\\e@Nq@JuAJ_DPs@DWPSCsB@qEFeBBkC@oCDmFHsD@uCDgEBy@EcAQu@YIGMKm@k@]a@MKuP_TaO}R}@uAu@eAsAoByAsBw@}@cA}@{AuAc@[e@Ue@Ok@KYCo@?s@Ha@Ja@Nc@VcAr@qBhB{ApA}AjAs@d@_AZ_AHc@BGDGJcCAaGEmDCsJAmLEsECsFC{D@{CAeHEkB@iIFwCHu@?eGBuFAgLAgQH_J?cWEsZKqAB}CNcBT{AXwBf@{DpAcPtFoLfEiBt@eGpBeS|GuBl@mBZyCRsB@cBIoEk@sXoFkDq@a@I_Do@sD{@{CaAkAc@sAk@aFcCoAm@uDmBuFkCuDiB{EcCaHiD}]qQ{JcFs@_@_Am@?M?GOYaAoAOUSm@Kc@Eo@As@HaARy@hAoCvBaFl@oAJc@n@wAlA{Cl@eBbAqDnAcGj@sDd@_EjAuK^_E^mFF_BTwHFqE?gEAuLCkPO}a@ImMCeHF}j@E{JCgG@uHDeBFmCPkE^cGXgDJsAl@wFfAiHz@yEbB}HrBuJzByK^sCT}CFaB?mB@mGFsC\\{FP_B`@}CzFk^Z{B^aDXsEZaHdAoXXiFl@iHbBmNH@\\aB^yAb@mAfAsBPm@Fu@Am@}AAU?eDEyBC{@Es@Bu@?}B?uFAwEF{@Cu@?kF@kJEyJC{GCj@eK{I@iIFqDAmA?wCHmBAAeGAyCO?]BQBg@P]Ng@LsA@_AA]GSKe@]g@{AMi@Iq@CSAoBhABfAAFs@DUTWNGd@A?r@?jB"]}],true,"defaultLayerId",true,false,0,false]}]},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 2: Example AM Commute Routes
</p>
</div>
</div>
<h1 id="adjusting-auto-travel-times-for-decreased-congestion-during-the-covid-19-pandemic">Adjusting Auto Travel Times for Decreased Congestion during the COVID-19 Pandemic</h1>
<p>There is a desire within NN to continue using Google to query travel times, but to be able to adjust these to represent assumed post-pandemic conditions. We are doing this at the metro area level to keep the analysis high level and to comply with data source limitations. To start, we are attempting this exercise for eight example metro areas:</p>
<ul>
<li>Austin-Round Rock-Georgetown, TX</li>
<li>Boston-Worcester-Providence, MA-RI-NH-CT</li>
<li>Chicago-Naperville, IL-IN-WI</li>
<li>New York-Newark, NY-NJ-CT-PA</li>
<li>Portland-Vancouver-Salem, OR-WA<br />
</li>
<li>San Jose-San Francisco-Oakland, CA</li>
<li>Seattle-Tacoma, WA<br />
</li>
<li>Washington-Baltimore-Arlington, DC-MD-VA-WV-PA</li>
</ul>
<p>We were going to try to use Los Angeles, but Replica currently does not have data provided for this metro area.</p>
<p>We make use of two data sources to estimate the COVID-19 pandemic’s effect on Travel Time Indices in the example metro areas:</p>
<ul>
<li>The <strong>Texas Transportation Institute</strong> has estimated average Travel Time Indices for each major metro area in the U.S. for many years between 1982 and 2017 – future indices will be coming, but it takes several years for new reports to be published, so there is a lag in available information. Nevertheless, this is a useful statistic for seeing how much of peak congestion effect exists in each metro area over time. We will assume the 2017 travel time index as our baseline because we have no better data point to use.</li>
<li><strong>Replica</strong> provides weekly estimates of the proportion of people in a metro area traveling to work/school on the average weekday – this is extremely useful in understanding how travel patterns have changed throughout the pandemic, and this data fortunately goes back to the beginning of 2020, so we can see the full picture of how this travel has changed in each metro area over time. This change will be the source of how we adjust current travel times – at the current proportion of home/work travel, which we assume drives peak traffic congestion.</li>
</ul>
<p>This is <strong>not</strong> a vetted methodology. We are trying to make use of the data we have to provide an estimate based on some simple assumptions, but we have not validated it in any kind of testing. Feedback is welcome to improve the methodology going forward. Beyond issues present in the methodology, there is a big assumption being made here that may not turn out to be true – that the level of work/school travel will return to pre-pandemic levels in the near future, if at all. We may see permanent changes in travel patterns – it is too soon to tell.</p>
<h2 id="travel-time-indices">Travel Time Indices</h2>
<p>Texas Transportation Institute’s Travel Time Index data is available from 1982-2017 from the <a href="https://www.bts.gov/content/travel-time-index">Bureau of Transportation Statistics</a>, a division of the U.S. Department of Transportation. The spreadsheet provided there is read in below and manipulated into a format easy for plotting and joining to other data. The <code>tigris</code> package is used to fetch the <code>GEOID</code> for each <a href="https://www.census.gov/programs-surveys/metro-micro/about.html">metropolitan statistical area as defined by the U.S. Census Bureau</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tt_index</span> <span class='op'>=</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='st'>'data/table_01_70_112119.xlsx'</span>,skip<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>urban_area</span><span class='op'>:</span><span class='va'>x2017</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>contains</span><span class='op'>(</span><span class='st'>'x'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rename</span><span class='op'>(</span>year <span class='op'>=</span> <span class='va'>name</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'>str_replace</span><span class='op'>(</span><span class='va'>year</span>,<span class='st'>'x'</span>,<span class='st'>''</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
           <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rename</span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>urban_area</span>,<span class='st'>'average'</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>cbsa_geom</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/tigris/man/core_based_statistical_areas.html'>core_based_statistical_areas</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'>#filtered using a regular expression</span>
<span class='va'>sub_cbsa_geom</span> <span class='op'>=</span> <span class='va'>cbsa_geom</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>NAME</span>,<span class='st'>'Boston|Portland-Vancouver|San Francisco|Los Angeles|Seattle|New York|Washington-Arlington|Austin-Round|Chicago'</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#Joining in the GEOIDs manually assembled from the CBSA data and joined to the versions of the metro area names in the TTI data</span>
<span class='va'>sub_tt_index</span> <span class='op'>=</span> <span class='va'>tt_index</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>urban_area</span>,<span class='st'>'Boston|Portland|San Francisco|Los Angeles|Seattle|New York|Washington|Austin|Chicago'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='fu'>tibble</span><span class='op'>(</span>
    urban_area <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Austin, TX"</span>,<span class='st'>"Boston, MA-NH-RI"</span>,<span class='st'>"Chicago, IL-IN"</span>,<span class='st'>"Los Angeles-Long Beach-Santa Ana, CA"</span>,
                   <span class='st'>"New York-Newark, NY-NJ-CT"</span>,<span class='st'>"Portland, OR-WA"</span>,<span class='st'>"San Francisco-Oakland, CA"</span>,<span class='st'>"Seattle, WA"</span>,
                   <span class='st'>"Washington, DC-VA-MD"</span><span class='op'>)</span>,
    GEOID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"12420"</span>,<span class='st'>"14460"</span>,<span class='st'>"16980"</span>,<span class='st'>"31080"</span>,<span class='st'>"35620"</span>,<span class='st'>"38900"</span>,<span class='st'>"41860"</span>,<span class='st'>"42660"</span>,<span class='st'>"47900"</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>sub_cbsa_geom</span> <span class='op'>%&gt;%</span>
              <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
              <span class='fu'>select</span><span class='op'>(</span><span class='va'>GEOID</span>,<span class='va'>NAME</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Below is a plot of the travel time index by metro area from 1982 - 2017. Generally they have increased, but there are differences between metro areas.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>sub_tt_index</span>,<span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>year</span>,y<span class='op'>=</span><span class='va'>index</span>,color<span class='op'>=</span><span class='va'>NAME</span>,group<span class='op'>=</span><span class='va'>NAME</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'>ylab</span><span class='op'>(</span><span class='st'>'Travel Time Index'</span><span class='op'>)</span><span class='op'>+</span><span class='fu'>xlab</span><span class='op'>(</span><span class='st'>'Year'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span>,name<span class='op'>=</span><span class='st'>'Metropolitan Area'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,
        text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:tti-fig-1"></span>
<img src="google-travel-time-querying_files/figure-html5/tti-fig-1-1.png" alt="Travel Time Index by Metro Area (1982-2017)" width="2000" />
<p class="caption">
Figure 3: Travel Time Index by Metro Area (1982-2017)
</p>
</div>
</div>
<h2 id="replica-travel-to-workschool-rate-over-2020">Replica: Travel to Work/School Rate over 2020</h2>
<p>Now we turn to the Replica data – how have work/school travel rates on the average weekday changed over 2020 in each metro area?</p>
<p>First, we load in all the replica data and bind it into one dataframe (from multiple CSV files).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#Replica data</span>
<span class='va'>replica_files</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span><span class='st'>'data/replica/'</span><span class='op'>)</span>

<span class='va'>replica_list</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>replica_files</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>fh</span> <span class='op'>=</span> <span class='va'>replica_files</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>
  <span class='va'>raw</span> <span class='op'>=</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'data/replica/'</span>,<span class='va'>fh</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>replica_list</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>raw</span>
<span class='op'>}</span>

<span class='va'>replica_frame</span> <span class='op'>=</span> <span class='fu'>bind_rows</span><span class='op'>(</span><span class='va'>replica_list</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>week_starting <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>week_starting</span>,
                                 format <span class='op'>=</span> <span class='st'>'%m-%d-%Y'</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Then, we can plot the proportion of each metro area population traveling to work/school on the average weekday.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>replica_frame</span>,<span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>week_starting</span>,y<span class='op'>=</span><span class='va'>traveling_work_school_proportion_avg_weekday</span>,
                         color<span class='op'>=</span><span class='va'>msa</span>,group<span class='op'>=</span><span class='va'>msa</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels<span class='op'>=</span><span class='va'>percent</span>,limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span>,name<span class='op'>=</span><span class='st'>'Metropolitan Area'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>'Proportion of Metro Area Population\nTraveling to Work/School on Average Weekday'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>'Date (first day of week)'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,
        text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:replica-fig-1"></span>
<img src="google-travel-time-querying_files/figure-html5/replica-fig-1-1.png" alt="Proportion of Metro Area Population Traveling to Work/School on Average Weekday" width="2000" />
<p class="caption">
Figure 4: Proportion of Metro Area Population Traveling to Work/School on Average Weekday
</p>
</div>
</div>
<p>To understand how we will adjust the travel time index, we normalize to a baseline, which we assume to be the first full week (post new years) in January 2020 – you can see how the proportion of people who travel to work/school changes relative to that baseline. Below, we will adjust the 2017 travel time index for each metro are based on the changes relative to that baseline.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>replica_frame</span>,<span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>week_starting</span>,y<span class='op'>=</span><span class='va'>traveling_work_school_change_in_proportion_since_baseline</span>,
                         color<span class='op'>=</span><span class='va'>msa</span>,group<span class='op'>=</span><span class='va'>msa</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels<span class='op'>=</span><span class='va'>percent</span>,limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.75</span>,<span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>'% Difference from Baseline of Work/School Travel on Average Weekday'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>'Date (first day of week)'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span>,name<span class='op'>=</span><span class='st'>'Metropolitan Area'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,
        text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:replica-fig-2"></span>
<img src="google-travel-time-querying_files/figure-html5/replica-fig-2-1.png" alt="% Difference from Baseline of Work/School Travel on Average Weekday" width="2000" />
<p class="caption">
Figure 5: % Difference from Baseline of Work/School Travel on Average Weekday
</p>
</div>
</div>
<h2 id="using-replica-to-predict-presentfuture-travel-time-indices">Using Replica to Predict Present/Future Travel Time Indices</h2>
<p>As described above, we can adjust the travel time indices for each metro area based on the change in proportion of travel to work/school. Below we have assumed that the travel time index cannot drop below 1, and so the proportion is only used to adjust the delta above 1.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adj_tt_index</span> <span class='op'>=</span> <span class='va'>sub_tt_index</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>2017</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>replica_frame</span> <span class='op'>%&gt;%</span>
              <span class='fu'>select</span><span class='op'>(</span><span class='va'>geo_id</span>,<span class='va'>week_starting</span>,<span class='va'>traveling_work_school_change_in_proportion_since_baseline</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
              <span class='fu'>rename</span><span class='op'>(</span>GEOID <span class='op'>=</span> <span class='va'>geo_id</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
              <span class='fu'>mutate</span><span class='op'>(</span>GEOID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>GEOID</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>week_starting</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ex_tti_delta <span class='op'>=</span> <span class='va'>index</span> <span class='op'>-</span> <span class='fl'>1</span>,
         prj_tti <span class='op'>=</span> <span class='va'>ex_tti_delta</span><span class='op'>*</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>+</span><span class='va'>traveling_work_school_change_in_proportion_since_baseline</span><span class='op'>)</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>adjustment_factor <span class='op'>=</span> <span class='va'>prj_tti</span><span class='op'>/</span><span class='va'>index</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>adj_tt_index</span>,<span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>week_starting</span>,y<span class='op'>=</span><span class='va'>prj_tti</span>,
                        color<span class='op'>=</span><span class='va'>NAME</span>,group<span class='op'>=</span><span class='va'>NAME</span>, fill<span class='op'>=</span><span class='va'>NAME</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>lty<span class='op'>=</span><span class='fl'>2</span>,span<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,
        text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span>,name<span class='op'>=</span><span class='st'>'Metropolitan Area'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_fill_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span>,name<span class='op'>=</span><span class='st'>'Metropolitan Area'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>NAME</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>'Date (first day of week)'</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>'Adjusted Travel Time Index for 2020'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:tt-index-adjust"></span>
<img src="google-travel-time-querying_files/figure-html5/tt-index-adjust-1.png" alt="Adjusted Travel Time Indices for 2020" width="2000" />
<p class="caption">
Figure 6: Adjusted Travel Time Indices for 2020
</p>
</div>
</div>
<h1 id="example-travel-time-adjustment-boston-ma">Example Travel Time Adjustment – Boston, MA</h1>
<p>Below we demonstrate an example of using the adjustment factors calculated above to adjust travel times for a travel pattern in Boston – between Everett Square and Logan International Airport. First we compute the directions in both directions, similar to the way we did in the first example.</p>
<h2 id="directions-to-logan">Directions to Logan</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dir_results_to_logan</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_directions.html'>google_directions</a></span><span class='op'>(</span>origin <span class='op'>=</span> <span class='st'>'Everett Square, Boston, MA'</span>,
                  destination <span class='op'>=</span> <span class='st'>'Logan International Airport Boston, MA'</span>,
                  mode <span class='op'>=</span> <span class='st'>'driving'</span>,
                  departure_time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>'2021-01-26 07:30:00'</span>, tz<span class='op'>=</span><span class='st'>'America/New_York'</span><span class='op'>)</span>,
                  alternatives <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>


<span class='va'>tt_frame_to_logan</span> <span class='op'>=</span> <span class='va'>dir_results_to_logan</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>legs</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tibble</span><span class='op'>(</span>legs <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>legs</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='fu'>contains</span><span class='op'>(</span><span class='st'>'duration'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>duration_minutes_no_traffic <span class='op'>=</span> <span class='va'>duration</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span>,
         duration_minutes_with_traffic <span class='op'>=</span> <span class='va'>duration_in_traffic</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span>

<span class='va'>polys_to_logan</span> <span class='op'>=</span> <span class='va'>dir_results_to_logan</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>overview_polyline</span><span class='op'>$</span><span class='va'>points</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span>poly<span class='op'>=</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>decoded_poly <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>poly</span>,<span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/decode_pl.html'>decode_pl</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>tt_frame_to_logan</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>map_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'Alternative #'</span>,<span class='va'>alternative_num</span>,<span class='st'>': '</span>,
                            <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>duration_minutes_with_traffic</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='st'>' minutes with traffic'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>tti <span class='op'>=</span> <span class='va'>duration_minutes_with_traffic</span><span class='op'>/</span><span class='va'>duration_minutes_no_traffic</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>tti</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#See what the travel time indices are</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>polys_to_logan</span><span class='op'>$</span><span class='va'>tti</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.8964194 0.8977741</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_map.html'>google_map</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>polys_to_logan</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/add_polylines.html'>add_polylines</a></span><span class='op'>(</span>polyline <span class='op'>=</span> <span class='st'>'poly'</span>,stroke_weight <span class='op'>=</span> <span class='fl'>9</span>,mouse_over <span class='op'>=</span> <span class='st'>'map_label'</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:boston-ex-part-1"></span>
<div id="htmlwidget-7960474a3decfa9b5716" style="width:768px;height:576px;" class="google_map html-widget"></div>
<script type="application/json" data-for="htmlwidget-7960474a3decfa9b5716">{"x":{"lat":-37.9,"lng":144.5,"zoom":8,"styles":null,"search_box":false,"update_map_view":true,"zoomControl":true,"mapTypeControl":true,"scaleControl":false,"streetViewControl":true,"rotateControl":true,"fullscreenControl":true,"event_return_type":"list","split_view":null,"split_view_options":{"heading":34,"pitch":10},"geolocation":false,"calls":[{"functions":"add_polylines","args":[[{"mouse_over":"Alternative #1: 11.7 minutes with traffic","id":1,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["i|paG`gdqLEz@d@FjCXHw@T{BVoC\\qCoBeCq@{@EI@Yj@KTK`@Up@m@nD{EvGaJdEwBVKm@}BW_ADa@k@wC}BwKIe@A[DiALm@Tg@T]VUTKl@QFGBKvB[n@IPEj@S|@a@\\Wl@o@n@{@|@iAv@w@lB{AJKx@i@dA{@v@u@pAmB~GaPnAaDvA_Fr@sB`AsBvCoGl@{At@_C`A}DZoBd@wDt@yGzBaST{BNsCDqB@qBCwQCsZ?wJHuCNcCHyAFqCMaYGkPIgNO_PGoK?{U@qBD{AFeAf@{HVwC^wCfAgH|@mG\\mCHi@RqBT_E@_BAaBOaFMkByAcM}Eia@_@eDGy@K_BSqDI_D@uCRgF^gDb@kB|B{Hd@cB^gBRqARaCHwB?oCGsAKmBUcBc@iCi@wBiAuDc@iAMUc@][YWg@k@mAa@q@y@qA{@iAaAmA}@cAcAeAeAaA][}@q@gD{BuRmKsBcAoAu@gD}AqBaAs@]}@WeBi@a@IcASiEk@QCKAQQCAeAMkDa@oB_@q@K}B[wCQcGOiBFg@JwATsFpA"]},{"mouse_over":"Alternative #2: 18.1 minutes with traffic","id":2,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["i|paG`gdqLEz@d@FjCXHw@T{BVoC\\qCoBeCq@{@EI@Yj@KTK`@Up@m@nD{EvGaJdEwBVKm@}BW_AgBcIMa@U{@o@eBgBwDw@kBg@cBg@_Cc@uDw@kGKe@CKXEREXC~AMxA@zAJX?JCzBh@~Bh@TFpAX`APtAHhACv@GzA[x@[f@Yd@]v@u@^g@Zg@fEgJnBqEb@oA`@mBPoANsB^yK`AwR`AaSRgHtAmf@FeDEeASaCm@_DUaBOoASaEGqAQ}AQ_A}@kFQqAk@eFw@sEqIkf@m@cDISMi@EO[qA{@aF}A{HeAwE_AoFYu@i@i@e@YkA_@OIu@WaBg@qEy@wCg@iBK[Dc@Lu@Zc@Lg@BqAIq@IUKUQa@k@Y_A_@oA[g@]Y}@g@eBaAgEcBUKSU[Q_Aa@e@YUUSYkB}Ba@o@Mi@E_AFEFIF_@jAcJVqAV}@N_@\\_@x@aA|CqCRIh@APFDSTuAt@oExAcJN_AGe@KQUo@g@eAw@_BCMBMDQb@g@p@}@Na@pAqBfAkBl@mAJ]N}@Di@Cg@Go@Oq@_@s@W]IUW]SYk@w@i@u@yRk\\kJ{OaBmCyM{UwIsOa@i@y@eAw@_A[c@M_@Ou@Gw@?m@H{@Xm@lBkEr@eB^oALe@BIBYBq@?qAEo@Ms@Sw@m@mAoCaD]g@Oc@Ic@A_AFm@Ro@NYPOt@a@|@a@v@k@d@c@d@g@^i@FQv@cAjA_Bn@_A"]}],true,"defaultLayerId",true,false,0,false]}]},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 7: Routes to Logan
</p>
</div>
</div>
<h2 id="directions-from-logan">Directions from Logan</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dir_results_from_logan</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_directions.html'>google_directions</a></span><span class='op'>(</span>destination<span class='op'>=</span> <span class='st'>'Everett Square, Boston, MA'</span>,
                  origin <span class='op'>=</span> <span class='st'>'Logan International Airport Boston, MA'</span>,
                  mode <span class='op'>=</span> <span class='st'>'driving'</span>,
                  departure_time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>'2021-01-26 12:00:00'</span>, tz<span class='op'>=</span><span class='st'>'America/New_York'</span><span class='op'>)</span>,
                  alternatives <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>


<span class='va'>tt_frame_from_logan</span> <span class='op'>=</span> <span class='va'>dir_results_from_logan</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>legs</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tibble</span><span class='op'>(</span>legs <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>legs</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='fu'>contains</span><span class='op'>(</span><span class='st'>'duration'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>duration_minutes_no_traffic <span class='op'>=</span> <span class='va'>duration</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span>,
         duration_minutes_with_traffic <span class='op'>=</span> <span class='va'>duration_in_traffic</span><span class='op'>$</span><span class='va'>value</span><span class='op'>/</span><span class='fl'>60</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span>

<span class='va'>polys_from_logan</span> <span class='op'>=</span> <span class='va'>dir_results_to_logan</span><span class='op'>$</span><span class='va'>routes</span><span class='op'>$</span><span class='va'>overview_polyline</span><span class='op'>$</span><span class='va'>points</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span>poly<span class='op'>=</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>decoded_poly <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>poly</span>,<span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/decode_pl.html'>decode_pl</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>alternative_num <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>tt_frame_from_logan</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>map_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'Alternative #'</span>,<span class='va'>alternative_num</span>,<span class='st'>': '</span>,
                            <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>duration_minutes_with_traffic</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='st'>' minutes with traffic'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>tti <span class='op'>=</span> <span class='va'>duration_minutes_with_traffic</span><span class='op'>/</span><span class='va'>duration_minutes_no_traffic</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>tti</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#See what the travel time indices are</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>polys_from_logan</span><span class='op'>$</span><span class='va'>tti</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.8985646 0.9352697</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/googleway/man/google_map.html'>google_map</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>polys_from_logan</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/pkg/googleway/man/add_polylines.html'>add_polylines</a></span><span class='op'>(</span>polyline <span class='op'>=</span> <span class='st'>'poly'</span>,stroke_weight <span class='op'>=</span> <span class='fl'>9</span>,mouse_over <span class='op'>=</span> <span class='st'>'map_label'</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:boston-ex-part-2"></span>
<div id="htmlwidget-356c3b4d1c383f803cc1" style="width:768px;height:576px;" class="google_map html-widget"></div>
<script type="application/json" data-for="htmlwidget-356c3b4d1c383f803cc1">{"x":{"lat":-37.9,"lng":144.5,"zoom":8,"styles":null,"search_box":false,"update_map_view":true,"zoomControl":true,"mapTypeControl":true,"scaleControl":false,"streetViewControl":true,"rotateControl":true,"fullscreenControl":true,"event_return_type":"list","split_view":null,"split_view_options":{"heading":34,"pitch":10},"geolocation":false,"calls":[{"functions":"add_polylines","args":[[{"mouse_over":"Alternative #1: 15.7 minutes with traffic","id":1,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["i|paG`gdqLEz@d@FjCXHw@T{BVoC\\qCoBeCq@{@EI@Yj@KTK`@Up@m@nD{EvGaJdEwBVKm@}BW_ADa@k@wC}BwKIe@A[DiALm@Tg@T]VUTKl@QFGBKvB[n@IPEj@S|@a@\\Wl@o@n@{@|@iAv@w@lB{AJKx@i@dA{@v@u@pAmB~GaPnAaDvA_Fr@sB`AsBvCoGl@{At@_C`A}DZoBd@wDt@yGzBaST{BNsCDqB@qBCwQCsZ?wJHuCNcCHyAFqCMaYGkPIgNO_PGoK?{U@qBD{AFeAf@{HVwC^wCfAgH|@mG\\mCHi@RqBT_E@_BAaBOaFMkByAcM}Eia@_@eDGy@K_BSqDI_D@uCRgF^gDb@kB|B{Hd@cB^gBRqARaCHwB?oCGsAKmBUcBc@iCi@wBiAuDc@iAMUc@][YWg@k@mAa@q@y@qA{@iAaAmA}@cAcAeAeAaA][}@q@gD{BuRmKsBcAoAu@gD}AqBaAs@]}@WeBi@a@IcASiEk@QCKAQQCAeAMkDa@oB_@q@K}B[wCQcGOiBFg@JwATsFpA"]},{"mouse_over":"Alternative #2: 18.8 minutes with traffic","id":2,"stroke_weight":9,"geodesic":true,"stroke_colour":"#0000FF","stroke_opacity":0.6,"z_index":3,"polyline":["i|paG`gdqLEz@d@FjCXHw@T{BVoC\\qCoBeCq@{@EI@Yj@KTK`@Up@m@nD{EvGaJdEwBVKm@}BW_AgBcIMa@U{@o@eBgBwDw@kBg@cBg@_Cc@uDw@kGKe@CKXEREXC~AMxA@zAJX?JCzBh@~Bh@TFpAX`APtAHhACv@GzA[x@[f@Yd@]v@u@^g@Zg@fEgJnBqEb@oA`@mBPoANsB^yK`AwR`AaSRgHtAmf@FeDEeASaCm@_DUaBOoASaEGqAQ}AQ_A}@kFQqAk@eFw@sEqIkf@m@cDISMi@EO[qA{@aF}A{HeAwE_AoFYu@i@i@e@YkA_@OIu@WaBg@qEy@wCg@iBK[Dc@Lu@Zc@Lg@BqAIq@IUKUQa@k@Y_A_@oA[g@]Y}@g@eBaAgEcBUKSU[Q_Aa@e@YUUSYkB}Ba@o@Mi@E_AFEFIF_@jAcJVqAV}@N_@\\_@x@aA|CqCRIh@APFDSTuAt@oExAcJN_AGe@KQUo@g@eAw@_BCMBMDQb@g@p@}@Na@pAqBfAkBl@mAJ]N}@Di@Cg@Go@Oq@_@s@W]IUW]SYk@w@i@u@yRk\\kJ{OaBmCyM{UwIsOa@i@y@eAw@_A[c@M_@Ou@Gw@?m@H{@Xm@lBkEr@eB^oALe@BIBYBq@?qAEo@Ms@Sw@m@mAoCaD]g@Oc@Ic@A_AFm@Ro@NYPOt@a@|@a@v@k@d@c@d@g@^i@FQv@cAjA_Bn@_A"]}],true,"defaultLayerId",true,false,0,false]}]},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 8: Routes from Logan
</p>
</div>
</div>
<h2 id="adjusting-travel-times">Adjusting Travel Times</h2>
<p>We then grab the relevant adjustment factor from the above calculation – we assume the adjustment factor in Boston calculated for the week starting 2021-01-04 will give us an idea of how different the traffic is on a weekday in January from pre-pandemic levels. We then use that adjustment factor to scale up the travel times (without traffic) we got from Google. You can see below that the factor used (in this case we divided by 0.93) gets us a higher travel time than computed by Google with traffic – this speaks to the ahistorical level of traffic congestion occuring the COVID-19 pandemic. Both the Texas Transportation Institute numbers and the Replica numbers used are averages for a metro area, and so Google’s data may be more localized than these factors allow us to get. Professional judgment should be used with these estimates – I would use them more to provide a range of travel times to client, rather than a precise prediction.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>boston_adj_factor</span> <span class='op'>=</span> <span class='va'>adj_tt_index</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>urban_area</span><span class='op'>==</span><span class='st'>'Boston, MA-NH-RI'</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>adjustment_factor</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>boston_adj_factor</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.9296703</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bound_travel_times</span> <span class='op'>=</span> <span class='fu'>bind_rows</span><span class='op'>(</span>
  <span class='va'>polys_from_logan</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>direction <span class='op'>=</span> <span class='st'>'From Logan, 12 PM'</span><span class='op'>)</span>,
   <span class='va'>polys_to_logan</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>alternative_num</span>,<span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>direction <span class='op'>=</span> <span class='st'>'To Logan, 7:30 AM'</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>adj_traffic_time <span class='op'>=</span> <span class='va'>duration_minutes_no_traffic</span><span class='op'>/</span><span class='va'>boston_adj_factor</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>duration_minutes_no_traffic</span>,<span class='va'>duration_minutes_with_traffic</span>,
                        <span class='va'>adj_traffic_time</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='fu'>tibble</span><span class='op'>(</span>
    name <span class='op'>=</span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'duration_minutes_no_traffic'</span>,
              <span class='st'>'duration_minutes_with_traffic'</span>,
              <span class='st'>'adj_traffic_time'</span><span class='op'>)</span>,
    plot_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Google Duration, No Traffic'</span>,
                   <span class='st'>'Google Duration, With Traffic'</span>,
                   <span class='st'>'Adjusted Duration assuming pre-pandemic traffic'</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>direction <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>direction</span>,ordered<span class='op'>=</span><span class='cn'>TRUE</span>,
                            levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'To Logan, 7:30 AM'</span>,<span class='st'>'From Logan, 12 PM'</span><span class='op'>)</span><span class='op'>)</span>,
         plot_label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>plot_label</span>,ordered<span class='op'>=</span><span class='cn'>TRUE</span>,
                             levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Google Duration, No Traffic'</span>,
                   <span class='st'>'Google Duration, With Traffic'</span>,
                   <span class='st'>'Adjusted Duration assuming pre-pandemic traffic'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>bound_travel_times</span>,<span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>alternative_num</span><span class='op'>)</span>,y<span class='op'>=</span><span class='va'>value</span>,fill<span class='op'>=</span><span class='va'>plot_label</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>position <span class='op'>=</span> <span class='fu'>position_dodge</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_label</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>value</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,position <span class='op'>=</span> <span class='fu'>position_dodge</span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>0.9</span><span class='op'>)</span>,color<span class='op'>=</span><span class='st'>'white'</span>,
             fontface<span class='op'>=</span><span class='st'>'bold'</span>, show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>direction</span>,nrow<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>scale_fill_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>'Route Alternative'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>'Travel Time (minutes)'</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>, text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow<span class='op'>=</span><span class='fl'>3</span>,title <span class='op'>=</span> <span class='st'>'Estimate Type'</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:boston-ex-part-3"></span>
<img src="google-travel-time-querying_files/figure-html5/boston-ex-part-3-1.png" alt="Example Adjusted Travel Times in Boston" width="2000" />
<p class="caption">
Figure 9: Example Adjusted Travel Times in Boston
</p>
</div>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
